<config-template xmlns="http://tail-f.com/ns/config/1.0">
  <devices xmlns="http://tail-f.com/ns/ncs">
    <device>
      <name>{/device}</name>
      <config>
        <?if {/openconfig-system/system/clock/config/timezone-name}?>
        <clock xmlns="urn:ios">
          <timezone>
            <?if {$XE_TIMEZONE}?>
            <zone>{$XE_TIMEZONE}</zone>
            <?end?>
            <?if {$XE_TIMEZONE_OFFSET_HOURS}?>
            <hours>{$XE_TIMEZONE_OFFSET_HOURS}</hours>
            <?end?>
            <?if {$XE_TIMEZONE_OFFSET_MINUTES}?>
            <minutes>{$XE_TIMEZONE_OFFSET_MINUTES}</minutes>
            <?end?>
          </timezone>
        </clock>
        <?end?>
        <?if {/openconfig-system/system/config/hostname}?>
        <hostname xmlns="urn:ios">{/openconfig-system/system/config/hostname}</hostname>
        <?end?>
        <?if {/openconfig-system/system/config/domain-name}?>
        <ip xmlns="urn:ios">
          <domain>
            <name>{/openconfig-system/system/config/domain-name}</name>
          </domain>
          <ssh>
            <version when="{/openconfig-system/system/ssh-server/config/protocol-version='V2'}">2</version>
            <version when="{/openconfig-system/system/ssh-server/config/protocol-version='V1'}">1</version>
            <version when="{/openconfig-system/system/ssh-server/config/protocol-version='V1_V2'}" tags="delete"/>
          </ssh>
        </ip>
        <?end?>
        <?if {/openconfig-system/system/config/login-banner}?>
        <banner xmlns="urn:ios">
          <login>{/openconfig-system/system/config/login-banner}</login>
        </banner>
        <?end?>
        <?if {/openconfig-system/system/config/motd-banner}?>
        <banner xmlns="urn:ios">
          <motd>{/openconfig-system/system/config/motd-banner}</motd>
        </banner>
        <?end?>
        <?if {/openconfig-system/system/dns/servers}?>
        <ip xmlns="urn:ios">
          <name-server tags="replace">
            <?foreach {/openconfig-system/system/dns/servers/server}?>
            <name-server-list>
              <address>{current()/address}</address>
            </name-server-list>
            <?end?>
          </name-server>
        </ip>
        <?end?>

        <logging xmlns="urn:ios">
          <?if {$XE_CONSOLE_SEVERITY}?>
          <console>
            <severity-level>{$XE_CONSOLE_SEVERITY}</severity-level>
          </console>
          <monitor>
            <severity-level>{$XE_CONSOLE_SEVERITY}</severity-level>
          </monitor>
          <?end?>

          <?if {$XE_CONSOLE_FACILITY or $XE_REMOTE_FACILITY}?>
          <facility>{$XE_CONSOLE_FACILITY}</facility>
          <?else?>
          <facility>{$XE_REMOTE_FACILITY}</facility>
          <?end?>

          <host tags="replace">
            <?foreach {/openconfig-system/system/logging/remote-servers/remote-server}?>
            <ipv4>
              <host>{current()/host}</host>
            </ipv4>
            <?end?>
          </host>


          <?if {$XE_LOGGING_SOURCE_INF_NAME}?>
          <source-interface>
            <name>{$XE_LOGGING_SOURCE_INF_NAME}</name>
          </source-interface>
          <?end?>

        </logging>

        <?if {/openconfig-system/system/ntp}?>
        <ntp xmlns="urn:ios" tags="replace">
          <?if {/openconfig-system/system/ntp/config/enabled='true'}?>
          <?if {/openconfig-system/system/ntp/config/ntp-source-address}?>
          <?if {$XE_NTP_SOURCE_INF_TYPE}?>
          <source>
            <Loopback when="{$XE_NTP_SOURCE_INF_TYPE='Loopback'}">{$XE_NTP_SOURCE_INF_NUMBER}</Loopback>
            <GigabitEthernet when="{$XE_NTP_SOURCE_INF_TYPE='GigabitEthernet'}">{$XE_NTP_SOURCE_INF_NUMBER}</GigabitEthernet>
          </source>
          <?end?>
          <?end?>
          <?if {/openconfig-system/system/ntp/servers/server}?>
          <server tags="replace">
            <?foreach {/openconfig-system/system/ntp/servers/server}?>
            <peer-list>
              <name>{current()/config/address}</name>
              <?if {current()/config/iburst='true'}?>
              <iburst/>
              <?end?>
              <?if {current()/config/prefer='true'}?>
              <prefer/>
              <?end?>
              <version>{current()/config/version}</version>
            </peer-list>
            <?end?>
          </server>
          <?end?>
          <?else?>
          <source tags="delete"/>
          <server tags="delete"/>
          <?end?>
        </ntp>
        <line xmlns="urn:ios">
          <vty>
            <first>0</first>
            <last>4</last>
            <exec-timeout>
              <minutes>{$XE_EXEC_TIMEOUT_MINUTES}</minutes>
              <seconds>{$XE_EXEC_TIMEOUT_SECONDS}</seconds>
            </exec-timeout>
            <session-limit>{/openconfig-system/system/ssh-server/config/session-limit}</session-limit>
            <?if {/openconfig-system/system/ssh-server/config/enable='true'}?>
            <transport>
              <input>ssh</input>
            </transport>
            <?end?>
          </vty>
        </line>
        <?end?>
      </config>
    </device>
  </devices>
</config-template>
