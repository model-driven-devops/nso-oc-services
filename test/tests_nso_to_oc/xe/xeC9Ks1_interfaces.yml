---
- hosts: localhost
  gather_facts: no
  environment:
    NSO_DEVICE: xeswitch1
  vars:
    device: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xeswitch1', True) }}"
  tasks:
    - name: Run XE interfaces storm-control tests
      include_role:
        name: ned-to-oc-test
      vars:
        will_save_rollback: False
        script_path: ../../../package_nso_to_oc/xe/xe_interfaces.py
        api_test_data:
          - name: NSO configure Interfaces
            tags:
              - storm-control
            api_method: PATCH
            api_path: config/tailf-ned-cisco-ios:interface
            content: |
              interface:
                GigabitEthernet:
                  - name: '1/0/6'
                    storm-control:
                      broadcast:
                        level-bps-pps:
                          level:
                            bps: 1234
                      unicast:
                        level-bps-pps:
                          level:
                            pps: 6789
                  - name: '1/0/7'
                    storm-control:
                      broadcast:
                        level-bps-pps:
                          level:
                            bps: 31000
                      unicast:
                        level-bps-pps:
                          level:
                            pps: 32000
                  - name: '1/0/8'
                    storm-control:
                      broadcast:
                        level-bps-pps:
                          level:
                            bps: 41000000
                      unicast:
                        level-bps-pps:
                          level:
                            pps: 42000000
        assertions:
          - "oc_result.json['mdd:openconfig']['openconfig-interfaces:interfaces']['interface'][21]['openconfig-if-ethernet:ethernet']['openconfig-if-ethernet-mdd-ext:storm-control']['broadcast']['level']['config']['bps'] == '1234'"
          - "oc_result.json['mdd:openconfig']['openconfig-interfaces:interfaces']['interface'][21]['openconfig-if-ethernet:ethernet']['openconfig-if-ethernet-mdd-ext:storm-control']['unicast']['level']['config']['pps'] == '6789'"
          - "oc_result.json['mdd:openconfig']['openconfig-interfaces:interfaces']['interface'][22]['openconfig-if-ethernet:ethernet']['openconfig-if-ethernet-mdd-ext:storm-control']['broadcast']['level']['config']['bps'] == '31000'"
          - "oc_result.json['mdd:openconfig']['openconfig-interfaces:interfaces']['interface'][22]['openconfig-if-ethernet:ethernet']['openconfig-if-ethernet-mdd-ext:storm-control']['unicast']['level']['config']['pps'] == '32000'"
          - "oc_result.json['mdd:openconfig']['openconfig-interfaces:interfaces']['interface'][23]['openconfig-if-ethernet:ethernet']['openconfig-if-ethernet-mdd-ext:storm-control']['broadcast']['level']['config']['bps'] == '41000000'"
          - "oc_result.json['mdd:openconfig']['openconfig-interfaces:interfaces']['interface'][23]['openconfig-if-ethernet:ethernet']['openconfig-if-ethernet-mdd-ext:storm-control']['unicast']['level']['config']['pps'] == '42000000'"
