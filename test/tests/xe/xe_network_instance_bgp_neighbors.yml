---
- name: test network instance bgp neighbors
  hosts: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
  gather_facts: no
  connection: network_cli
  vars:
    device: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
    ansible_network_os: 'cisco.ios.ios'
  tasks:
    - name: test neighbor_remote_as_test
      tags:
        - neighbor_remote_as_test
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: BGP
                        openconfig-network-instance:name: BGP
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: BGP
                          openconfig-network-instance:name: BGP
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 remote-as 2:' in changes"

    - name: test neighbor_ttl_security
      tags:
        - neighbor_ttl_security
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: BGP
                        openconfig-network-instance:name: BGP
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: BGP
                          openconfig-network-instance:name: BGP
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                  openconfig-bgp-ext:ttl-security: 2
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 ttl-security hops 2:' in changes"


    - name: test neighbor_remote_auth_password
      tags:
        - neighbor_remote_auth_password
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                  openconfig-network-instance:auth-password: 'super_secret'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 password super_secret:' in changes"

    - name: test neighbor_remote_tcpao-keychain
      tags:
        - neighbor_remote_tcpao-keychain
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:key-chains:
                  openconfig-system-ext:key-chain:
                    - openconfig-system-ext:name: BGP-TCP_KEYCHAIN1
                      openconfig-system-ext:type: TCP
                      openconfig-system-ext:keys:
                        - openconfig-system-ext:id: 10
                          openconfig-system-ext:config:
                            openconfig-system-ext:id: 10
                            openconfig-system-ext:key-string: "cisco"
                            openconfig-system-ext:cryptographic-algorithm-tcp: "hmac-sha-1"
                            openconfig-system-ext:send-id: 99
                            openconfig-system-ext:recv-id: 100
                            openconfig-system-ext:accept-lifetime:
                              openconfig-system-ext:start-time: "00:00:00"
                              openconfig-system-ext:start-month: "Jan"
                              openconfig-system-ext:start-date: 1
                              openconfig-system-ext:start-year: 2023
                              openconfig-system-ext:duration: 364
                            openconfig-system-ext:send-lifetime:
                              openconfig-system-ext:start-time: "00:00:01"
                              openconfig-system-ext:start-month: "Feb"
                              openconfig-system-ext:start-date: 2
                              openconfig-system-ext:start-year: 2024
                              openconfig-system-ext:duration: 365
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.6'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.6'
                                  openconfig-network-instance:peer-as: 2
                                  openconfig-bgp-ext:tcpao-keychain: 'BGP-TCP_KEYCHAIN1'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.6 ao BGP-TCP_KEYCHAIN1:' in changes"

    - name: test neighbor_description
      tags:
        - neighbor_description
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                  openconfig-network-instance:description: 'as_2_peer'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 description as_2_peer:' in changes"

    - name: test neighbor_shutdown_test
      tags:
        - neighbor_shutdown_test
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                  openconfig-network-instance:enabled: False
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 shutdown:' in changes"

    - name: test neighbor_local_as_test
      tags:
        - neighbor_local_as_test
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                  openconfig-network-instance:local-as: 100
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 local-as 100:' in changes"

    - name: test neighbor_remove_private_as_all_test
      tags:
        - neighbor_remove_private_as_all_test
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                  openconfig-network-instance:remove-private-as: 'PRIVATE_AS_REMOVE_ALL'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 remove-private-as all:' in changes"

    - name: test neighbor_remove_private_as_replace_as_test
      tags:
        - neighbor_remove_private_as_replace_as_test
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                  openconfig-network-instance:remove-private-as: 'PRIVATE_AS_REPLACE_ALL'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 remove-private-as all replace-as:' in changes"

    - name: test neighbor_send_community_standard_test
      tags:
        - neighbor_send_community_standard_test
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                  openconfig-network-instance:send-community: 'STANDARD'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 send-community:' in changes"

    - name: test neighbor_send_community_extended_test
      tags:
        - neighbor_send_community_extended_test
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                  openconfig-network-instance:send-community: 'EXTENDED'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 send-community extended:' in changes"

    - name: test neighbor_send_community_both_test
      tags:
        - neighbor_send_community_both_test
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                  openconfig-network-instance:send-community: 'BOTH'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 send-community both:' in changes"

    - name: test neighbor_ebgp_multihop_test
      tags:
        - neighbor_ebgp_multihop_test
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:ebgp-multihop:
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:enabled: True
                                    openconfig-network-instance:multihop-ttl: 2
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 ebgp-multihop 2:' in changes"

    - name: test neighbor_route_reflector_client_test
      tags:
        - neighbor_route_reflector_client_test
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 1
                                openconfig-network-instance:route-reflector:
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:route-reflector-client: True
                                    openconfig-network-instance:route-reflector-cluster-id: '1.1.1.1'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 route-reflector-client:' in changes"
          - "'+ neighbor 10.11.11.2 cluster-id 1.1.1.1:' in changes"

    - name: test neighbor_route_reflector_client_test_ad_ipv4
      tags:
        - neighbor_route_reflector_client_test_ad_ipv4
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 1
                                openconfig-network-instance:route-reflector:
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:route-reflector-client: True
                                    openconfig-network-instance:route-reflector-cluster-id: '1.1.1.1'
                                openconfig-network-instance:afi-safis:
                                  openconfig-network-instance:afi-safi:
                                    - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                        openconfig-network-instance:enabled: true
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 cluster-id 1.1.1.1:' in changes"
          - "'+ address-family ipv4:' in changes"
          - "'+  neighbor 10.11.11.2 route-reflector-client:' in changes"

    - name: test neighbor_route_reflector_client_test_ad_vpnv4
      tags:
        - neighbor_route_reflector_client_test_ad_vpnv4
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 1
                                openconfig-network-instance:route-reflector:
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:route-reflector-client: True
                                    openconfig-network-instance:route-reflector-cluster-id: '1.1.1.1'
                                openconfig-network-instance:afi-safis:
                                  openconfig-network-instance:afi-safi:
                                    - openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                        openconfig-network-instance:enabled: true
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 cluster-id 1.1.1.1:' in changes"
          - "'+ address-family vpnv4:' in changes"
          - "'+  neighbor 10.11.11.2 route-reflector-client:' in changes"

    - name: test neighbor_route_reflector_client_test_ad_ipv4_vrf
      tags:
        - neighbor_route_reflector_client_test_ad_ipv4_vrf
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                - openconfig-network-instance:name: 'abc'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'abc'
                    openconfig-network-instance:type: 'L3VRF'
                    openconfig-network-instance:enabled: true
                    openconfig-network-instance:enabled-address-families:
                      - 'IPV4'
                    openconfig-network-instance:route-distinguisher: '1:1'
                    openconfig-network-instance-ext:route-targets-import:
                      - '100:100'
                      - '101:101'
                    openconfig-network-instance-ext:route-targets-export:
                      - '200:200'
                      - '202:202'
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 1
                                openconfig-network-instance:route-reflector:
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:route-reflector-client: True
                                    openconfig-network-instance:route-reflector-cluster-id: '1.1.1.1'
                                openconfig-network-instance:afi-safis:
                                  openconfig-network-instance:afi-safi:
                                    - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                        openconfig-network-instance:enabled: true

        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ address-family ipv4 vrf abc:' in changes"
          - "'+  neighbor 10.11.11.2 route-reflector-client:' in changes"
          - "'+  neighbor 10.11.11.2 cluster-id 1.1.1.1:' in changes"

    - name: test neighbor_timers_test
      tags:
        - neighbor_timers_test
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:timers:
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:hold-time: 90
                                    openconfig-network-instance:keepalive-interval: 30
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 timers 30 90:' in changes"

    - name: test neighbor_transport_mtud_disable_test
      tags:
        - neighbor_transport_mtud_disable_test
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:transport:
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:mtu-discovery: False
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 transport path-mtu-discovery disable:' in changes"

    - name: test neighbor_transport_passive_mode_test
      tags:
        - neighbor_transport_passive_mode_test
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:transport:
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:passive-mode: True
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 transport connection-mode passive:' in changes"

    - name: test neighbor_transport_local_address_test
      tags:
        - neighbor_transport_local_address_test
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'Loopback10'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'Loopback10'
                    openconfig-interfaces:type: 'softwareLoopback'
                    openconfig-interfaces:description: 'TEST123'
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.255.10.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.255.10.1'
                                  openconfig-if-ip:prefix-length: 32
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:transport:
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:local-address: 'Loopback10'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 update-source Loopback10:' in changes"

    - name: test ad-ipv4-activate
      tags:
        - ad-ipv4-activate
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:afi-safis:
                                  openconfig-network-instance:afi-safi:
                                    - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                        openconfig-network-instance:enabled: true
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ address-family ipv4:' in changes"
          - "'+  neighbor 10.11.11.2 activate:' in changes"

    - name: test ad-vpnv4-activate
      tags:
        - ad-vpnv4-activate
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:afi-safis:
                                  openconfig-network-instance:afi-safi:
                                    - openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                        openconfig-network-instance:enabled: true
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ address-family vpnv4:' in changes"
          - "'+  neighbor 10.11.11.2 activate:' in changes"

    - name: test ad-ipv4-activate-vrf
      tags:
        - ad-ipv4-activate-vrf
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                - openconfig-network-instance:name: 'abc'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'abc'
                    openconfig-network-instance:type: 'L3VRF'
                    openconfig-network-instance:enabled: true
                    openconfig-network-instance:enabled-address-families:
                      - 'IPV4'
                    openconfig-network-instance:route-distinguisher: '1:1'
                    openconfig-network-instance-ext:route-targets-import:
                      - '100:100'
                      - '101:101'
                    openconfig-network-instance-ext:route-targets-export:
                      - '200:200'
                      - '202:202'
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:afi-safis:
                                  openconfig-network-instance:afi-safi:
                                    - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                        openconfig-network-instance:enabled: true
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ address-family ipv4 vrf abc:' in changes"
          - "'+  neighbor 10.11.11.2 remote-as 2:' in changes"
          - "'+  neighbor 10.11.11.2 activate:' in changes"

    - name: test ad-ipv4-activate-vrf-route-map-in
      tags:
        - ad-ipv4-activate-vrf-route-map-in
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-routing-policy:routing-policy:
              openconfig-routing-policy:defined-sets:
                openconfig-bgp-policy:bgp-defined-sets:
                  openconfig-bgp-policy:as-path-sets:
                    openconfig-bgp-policy:as-path-set:
                      - openconfig-bgp-policy:as-path-set-name: '1'
                        openconfig-bgp-policy:config:
                          openconfig-bgp-policy:as-path-set-name: '1'
                          openconfig-bgp-policy:as-path-set-member:
                            - "^$"
              openconfig-routing-policy:policy-definitions:
                openconfig-routing-policy:policy-definition:
                  - openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:config:
                      openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:statements:
                      openconfig-routing-policy:statement:
                        - openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:conditions:
                            openconfig-bgp-policy:bgp-conditions:
                              openconfig-bgp-policy:match-as-path-set:
                                openconfig-bgp-policy:config:
                                  openconfig-bgp-policy:as-path-set: '1'
                                  openconfig-bgp-policy:match-set-options: 'ANY'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
                            openconfig-bgp-policy:bgp-actions:
                              openconfig-bgp-policy:set-community:
                                openconfig-bgp-policy:config:
                                  openconfig-bgp-policy:method: 'INLINE'  # INLINE or REFERENCE
                                  openconfig-bgp-policy:options: 'ADD'  # ADD, REMOVE, REPLACE
                                openconfig-bgp-policy:inline:
                                  openconfig-bgp-policy:config:
                                    openconfig-bgp-policy:communities:
                                      - '100:100'
                        - openconfig-routing-policy:name: '20'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '20'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                - openconfig-network-instance:name: 'abc'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'abc'
                    openconfig-network-instance:type: 'L3VRF'
                    openconfig-network-instance:enabled: true
                    openconfig-network-instance:enabled-address-families:
                      - 'IPV4'
                    openconfig-network-instance:route-distinguisher: '1:1'
                    openconfig-network-instance-ext:route-targets-import:
                      - '100:100'
                      - '101:101'
                    openconfig-network-instance-ext:route-targets-export:
                      - '200:200'
                      - '202:202'
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:afi-safis:
                                  openconfig-network-instance:afi-safi:
                                    - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                        openconfig-network-instance:enabled: true
                                      openconfig-network-instance:apply-policy:
                                        openconfig-network-instance:config:
                                          openconfig-network-instance:import-policy:
                                          - 'test'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ address-family ipv4 vrf abc:' in changes"
          - "'+  neighbor 10.11.11.2 route-map test in:' in changes"

    - name: test ad-ipv4-activate-vrf-route-map-out
      tags:
        - ad-ipv4-activate-vrf-route-map-out
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-routing-policy:routing-policy:
              openconfig-routing-policy:defined-sets:
                openconfig-bgp-policy:bgp-defined-sets:
                  openconfig-bgp-policy:as-path-sets:
                    openconfig-bgp-policy:as-path-set:
                      - openconfig-bgp-policy:as-path-set-name: '1'
                        openconfig-bgp-policy:config:
                          openconfig-bgp-policy:as-path-set-name: '1'
                          openconfig-bgp-policy:as-path-set-member:
                            - "^$"
              openconfig-routing-policy:policy-definitions:
                openconfig-routing-policy:policy-definition:
                  - openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:config:
                      openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:statements:
                      openconfig-routing-policy:statement:
                        - openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:conditions:
                            openconfig-bgp-policy:bgp-conditions:
                              openconfig-bgp-policy:match-as-path-set:
                                openconfig-bgp-policy:config:
                                  openconfig-bgp-policy:as-path-set: '1'
                                  openconfig-bgp-policy:match-set-options: 'ANY'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
                            openconfig-bgp-policy:bgp-actions:
                              openconfig-bgp-policy:set-community:
                                openconfig-bgp-policy:config:
                                  openconfig-bgp-policy:method: 'INLINE'  # INLINE or REFERENCE
                                  openconfig-bgp-policy:options: 'ADD'  # ADD, REMOVE, REPLACE
                                openconfig-bgp-policy:inline:
                                  openconfig-bgp-policy:config:
                                    openconfig-bgp-policy:communities:
                                      - '100:100'
                        - openconfig-routing-policy:name: '20'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '20'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                - openconfig-network-instance:name: 'abc'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'abc'
                    openconfig-network-instance:type: 'L3VRF'
                    openconfig-network-instance:enabled: true
                    openconfig-network-instance:enabled-address-families:
                      - 'IPV4'
                    openconfig-network-instance:route-distinguisher: '1:1'
                    openconfig-network-instance-ext:route-targets-import:
                      - '100:100'
                      - '101:101'
                    openconfig-network-instance-ext:route-targets-export:
                      - '200:200'
                      - '202:202'
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:afi-safis:
                                  openconfig-network-instance:afi-safi:
                                    - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                        openconfig-network-instance:enabled: true
                                      openconfig-network-instance:apply-policy:
                                        openconfig-network-instance:config:
                                          openconfig-network-instance:export-policy:
                                          - 'test'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ address-family ipv4 vrf abc:' in changes"
          - "'+  neighbor 10.11.11.2 route-map test out:' in changes"

    - name: test ad-vpnv4-activate-route-map-in
      tags:
        - ad-vpnv4-activate-route-map-in
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
            mdd:openconfig:
              openconfig-routing-policy:routing-policy:
                openconfig-routing-policy:defined-sets:
                  openconfig-bgp-policy:bgp-defined-sets:
                    openconfig-bgp-policy:as-path-sets:
                      openconfig-bgp-policy:as-path-set:
                        - openconfig-bgp-policy:as-path-set-name: '1'
                          openconfig-bgp-policy:config:
                            openconfig-bgp-policy:as-path-set-name: '1'
                            openconfig-bgp-policy:as-path-set-member:
                              - "^$"
                openconfig-routing-policy:policy-definitions:
                  openconfig-routing-policy:policy-definition:
                    - openconfig-routing-policy:name: 'test'
                      openconfig-routing-policy:config:
                        openconfig-routing-policy:name: 'test'
                      openconfig-routing-policy:statements:
                        openconfig-routing-policy:statement:
                          - openconfig-routing-policy:name: '10'
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:name: '10'
                            openconfig-routing-policy:conditions:
                              openconfig-bgp-policy:bgp-conditions:
                                openconfig-bgp-policy:match-as-path-set:
                                  openconfig-bgp-policy:config:
                                    openconfig-bgp-policy:as-path-set: '1'
                                    openconfig-bgp-policy:match-set-options: 'ANY'
                            openconfig-routing-policy:actions:
                              openconfig-routing-policy:config:
                                openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
                              openconfig-bgp-policy:bgp-actions:
                                openconfig-bgp-policy:set-community:
                                  openconfig-bgp-policy:config:
                                    openconfig-bgp-policy:method: 'INLINE'  # INLINE or REFERENCE
                                    openconfig-bgp-policy:options: 'ADD'  # ADD, REMOVE, REPLACE
                                  openconfig-bgp-policy:inline:
                                    openconfig-bgp-policy:config:
                                      openconfig-bgp-policy:communities:
                                        - '100:100'
                          - openconfig-routing-policy:name: '20'
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:name: '20'
                            openconfig-routing-policy:actions:
                              openconfig-routing-policy:config:
                                openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
              openconfig-network-instance:network-instances:
                openconfig-network-instance:network-instance:
                  - openconfig-network-instance:name: 'default'
                    openconfig-network-instance:config:
                      openconfig-network-instance:name: 'default'
                      openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                      openconfig-network-instance:enabled: true
                    openconfig-network-instance:protocols:
                      openconfig-network-instance:protocol:
                        - openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                          openconfig-network-instance:config:
                            openconfig-network-instance:enabled: True
                            openconfig-network-instance:identifier: 'BGP'
                            openconfig-network-instance:name: 'BGP'
                          openconfig-network-instance:bgp:
                            openconfig-network-instance:global:
                              openconfig-network-instance:config:
                                openconfig-network-instance:as: 1
                              openconfig-network-instance:afi-safis:
                                openconfig-network-instance:afi-safi:
                                  - openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                    openconfig-network-instance:config:
                                      openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                      openconfig-network-instance:enabled: true
                            openconfig-network-instance:neighbors:
                              openconfig-network-instance:neighbor:
                                - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:neighbor-address: '10.11.11.2'
                                    openconfig-network-instance:peer-as: 2
                                  openconfig-network-instance:afi-safis:
                                    openconfig-network-instance:afi-safi:
                                      - openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                        openconfig-network-instance:config:
                                          openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                          openconfig-network-instance:enabled: true
                                        openconfig-network-instance:apply-policy:
                                          openconfig-network-instance:config:
                                            openconfig-network-instance:import-policy:
                                            - 'test'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ address-family vpnv4:' in changes"
          - "'+  neighbor 10.11.11.2 route-map test in:' in changes"

    - name: test ad-vpnv4-activate-route-map-out
      tags:
        - ad-vpnv4-activate-route-map-out
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-routing-policy:routing-policy:
              openconfig-routing-policy:defined-sets:
                openconfig-bgp-policy:bgp-defined-sets:
                  openconfig-bgp-policy:as-path-sets:
                    openconfig-bgp-policy:as-path-set:
                      - openconfig-bgp-policy:as-path-set-name: '1'
                        openconfig-bgp-policy:config:
                          openconfig-bgp-policy:as-path-set-name: '1'
                          openconfig-bgp-policy:as-path-set-member:
                            - "^$"
              openconfig-routing-policy:policy-definitions:
                openconfig-routing-policy:policy-definition:
                  - openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:config:
                      openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:statements:
                      openconfig-routing-policy:statement:
                        - openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:conditions:
                            openconfig-bgp-policy:bgp-conditions:
                              openconfig-bgp-policy:match-as-path-set:
                                openconfig-bgp-policy:config:
                                  openconfig-bgp-policy:as-path-set: '1'
                                  openconfig-bgp-policy:match-set-options: 'ANY'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
                            openconfig-bgp-policy:bgp-actions:
                              openconfig-bgp-policy:set-community:
                                openconfig-bgp-policy:config:
                                  openconfig-bgp-policy:method: 'INLINE'  # INLINE or REFERENCE
                                  openconfig-bgp-policy:options: 'ADD'  # ADD, REMOVE, REPLACE
                                openconfig-bgp-policy:inline:
                                  openconfig-bgp-policy:config:
                                    openconfig-bgp-policy:communities:
                                      - '100:100'
                        - openconfig-routing-policy:name: '20'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '20'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:afi-safis:
                                  openconfig-network-instance:afi-safi:
                                    - openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:afi-safi-name: 'L3VPN_IPV4_UNICAST'
                                        openconfig-network-instance:enabled: true
                                      openconfig-network-instance:apply-policy:
                                        openconfig-network-instance:config:
                                          openconfig-network-instance:export-policy:
                                          - 'test'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ address-family vpnv4:' in changes"
          - "'+  neighbor 10.11.11.2 route-map test out:' in changes"

    - name: test ad-ipv4-route-map-in
      tags:
        - ad-ipv4-route-map-in
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-routing-policy:routing-policy:
              openconfig-routing-policy:defined-sets:
                openconfig-bgp-policy:bgp-defined-sets:
                  openconfig-bgp-policy:as-path-sets:
                    openconfig-bgp-policy:as-path-set:
                      - openconfig-bgp-policy:as-path-set-name: '1'
                        openconfig-bgp-policy:config:
                          openconfig-bgp-policy:as-path-set-name: '1'
                          openconfig-bgp-policy:as-path-set-member:
                            - "^$"
              openconfig-routing-policy:policy-definitions:
                openconfig-routing-policy:policy-definition:
                  - openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:config:
                      openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:statements:
                      openconfig-routing-policy:statement:
                        - openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:conditions:
                            openconfig-bgp-policy:bgp-conditions:
                              openconfig-bgp-policy:match-as-path-set:
                                openconfig-bgp-policy:config:
                                  openconfig-bgp-policy:as-path-set: '1'
                                  openconfig-bgp-policy:match-set-options: 'ANY'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
                            openconfig-bgp-policy:bgp-actions:
                              openconfig-bgp-policy:set-community:
                                openconfig-bgp-policy:config:
                                  openconfig-bgp-policy:method: 'INLINE'  # INLINE or REFERENCE
                                  openconfig-bgp-policy:options: 'ADD'  # ADD, REMOVE, REPLACE
                                openconfig-bgp-policy:inline:
                                  openconfig-bgp-policy:config:
                                    openconfig-bgp-policy:communities:
                                      - '100:100'
                        - openconfig-routing-policy:name: '20'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '20'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:afi-safis:
                                  openconfig-network-instance:afi-safi:
                                    - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                        openconfig-network-instance:enabled: true
                                      openconfig-network-instance:apply-policy:
                                        openconfig-network-instance:config:
                                          openconfig-network-instance:import-policy:
                                          - 'test'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ address-family ipv4:' in changes"
          - "'+  neighbor 10.11.11.2 route-map test in:' in changes"

    - name: test ad-ipv4-route-map-out
      tags:
        - ad-ipv4-route-map-out
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-routing-policy:routing-policy:
              openconfig-routing-policy:defined-sets:
                openconfig-bgp-policy:bgp-defined-sets:
                  openconfig-bgp-policy:as-path-sets:
                    openconfig-bgp-policy:as-path-set:
                      - openconfig-bgp-policy:as-path-set-name: '1'
                        openconfig-bgp-policy:config:
                          openconfig-bgp-policy:as-path-set-name: '1'
                          openconfig-bgp-policy:as-path-set-member:
                            - "^$"
              openconfig-routing-policy:policy-definitions:
                openconfig-routing-policy:policy-definition:
                  - openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:config:
                      openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:statements:
                      openconfig-routing-policy:statement:
                        - openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:conditions:
                            openconfig-bgp-policy:bgp-conditions:
                              openconfig-bgp-policy:match-as-path-set:
                                openconfig-bgp-policy:config:
                                  openconfig-bgp-policy:as-path-set: '1'
                                  openconfig-bgp-policy:match-set-options: 'ANY'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
                            openconfig-bgp-policy:bgp-actions:
                              openconfig-bgp-policy:set-community:
                                openconfig-bgp-policy:config:
                                  openconfig-bgp-policy:method: 'INLINE'  # INLINE or REFERENCE
                                  openconfig-bgp-policy:options: 'ADD'  # ADD, REMOVE, REPLACE
                                openconfig-bgp-policy:inline:
                                  openconfig-bgp-policy:config:
                                    openconfig-bgp-policy:communities:
                                      - '100:100'
                        - openconfig-routing-policy:name: '20'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '20'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:afi-safis:
                                  openconfig-network-instance:afi-safi:
                                    - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                        openconfig-network-instance:enabled: true
                                      openconfig-network-instance:apply-policy:
                                        openconfig-network-instance:config:
                                          openconfig-network-instance:export-policy:
                                          - 'test'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ address-family ipv4:' in changes"
          - "'+  neighbor 10.11.11.2 route-map test out:' in changes"

    - name: test neighbor_route_map_in
      tags:
        - neighbor_route_map_in
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-routing-policy:routing-policy:
              openconfig-routing-policy:defined-sets:
                openconfig-bgp-policy:bgp-defined-sets:
                  openconfig-bgp-policy:as-path-sets:
                    openconfig-bgp-policy:as-path-set:
                      - openconfig-bgp-policy:as-path-set-name: '1'
                        openconfig-bgp-policy:config:
                          openconfig-bgp-policy:as-path-set-name: '1'
                          openconfig-bgp-policy:as-path-set-member:
                            - "^$"
              openconfig-routing-policy:policy-definitions:
                openconfig-routing-policy:policy-definition:
                  - openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:config:
                      openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:statements:
                      openconfig-routing-policy:statement:
                        - openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:conditions:
                            openconfig-bgp-policy:bgp-conditions:
                              openconfig-bgp-policy:match-as-path-set:
                                openconfig-bgp-policy:config:
                                  openconfig-bgp-policy:as-path-set: '1'
                                  openconfig-bgp-policy:match-set-options: 'ANY'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
                            openconfig-bgp-policy:bgp-actions:
                              openconfig-bgp-policy:set-community:
                                openconfig-bgp-policy:config:
                                  openconfig-bgp-policy:method: 'INLINE'  # INLINE or REFERENCE
                                  openconfig-bgp-policy:options: 'ADD'  # ADD, REMOVE, REPLACE
                                openconfig-bgp-policy:inline:
                                  openconfig-bgp-policy:config:
                                    openconfig-bgp-policy:communities:
                                      - '100:100'
                        - openconfig-routing-policy:name: '20'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '20'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:apply-policy:
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:import-policy:
                                    - 'test'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 route-map test in:' in changes"

    - name: test neighbor_route_map_out
      tags:
        - neighbor_route_map_out
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-routing-policy:routing-policy:
              openconfig-routing-policy:defined-sets:
                openconfig-bgp-policy:bgp-defined-sets:
                  openconfig-bgp-policy:as-path-sets:
                    openconfig-bgp-policy:as-path-set:
                      - openconfig-bgp-policy:as-path-set-name: '1'
                        openconfig-bgp-policy:config:
                          openconfig-bgp-policy:as-path-set-name: '1'
                          openconfig-bgp-policy:as-path-set-member:
                            - "^$"
              openconfig-routing-policy:policy-definitions:
                openconfig-routing-policy:policy-definition:
                  - openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:config:
                      openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:statements:
                      openconfig-routing-policy:statement:
                        - openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:conditions:
                            openconfig-bgp-policy:bgp-conditions:
                              openconfig-bgp-policy:match-as-path-set:
                                openconfig-bgp-policy:config:
                                  openconfig-bgp-policy:as-path-set: '1'
                                  openconfig-bgp-policy:match-set-options: 'ANY'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
                            openconfig-bgp-policy:bgp-actions:
                              openconfig-bgp-policy:set-community:
                                openconfig-bgp-policy:config:
                                  openconfig-bgp-policy:method: 'INLINE'  # INLINE or REFERENCE
                                  openconfig-bgp-policy:options: 'ADD'  # ADD, REMOVE, REPLACE
                                openconfig-bgp-policy:inline:
                                  openconfig-bgp-policy:config:
                                    openconfig-bgp-policy:communities:
                                      - '100:100'
                        - openconfig-routing-policy:name: '20'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '20'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:apply-policy:
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:export-policy:
                                    - 'test'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ neighbor 10.11.11.2 route-map test out:' in changes"

    # TODO add all neighbor tests from default rt ipv4 to address-family ipv4 unicast vrf XXX

    - name: test ad-ipv4-activate-vrf-send-label
      tags:
        - ad-ipv4-activate-vrf-send-label
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                - openconfig-network-instance:name: 'abc'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'abc'
                    openconfig-network-instance:type: 'L3VRF'
                    openconfig-network-instance:enabled: true
                    openconfig-network-instance:enabled-address-families:
                      - 'IPV4'
                    openconfig-network-instance:route-distinguisher: '1:1'
                    openconfig-network-instance-ext:route-targets-import:
                      - '100:100'
                      - '101:101'
                    openconfig-network-instance-ext:route-targets-export:
                      - '200:200'
                      - '202:202'
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_LABELED_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_LABELED_UNICAST'
                                    openconfig-network-instance:enabled: true
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:afi-safis:
                                  openconfig-network-instance:afi-safi:
                                    - openconfig-network-instance:afi-safi-name: 'IPV4_LABELED_UNICAST'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:afi-safi-name: 'IPV4_LABELED_UNICAST'
                                        openconfig-network-instance:enabled: true
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ address-family ipv4 vrf abc:' in changes"
          - "'+  neighbor 10.11.11.2 activate:' in changes"
          - "'+  neighbor 10.11.11.2 send-label:' in changes"

    - name: test ad-ipv4-activate-vrf-as-override
      tags:
        - ad-ipv4-activate-vrf-as-override
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                - openconfig-network-instance:name: 'abc'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'abc'
                    openconfig-network-instance:type: 'L3VRF'
                    openconfig-network-instance:enabled: true
                    openconfig-network-instance:enabled-address-families:
                      - 'IPV4'
                    openconfig-network-instance:route-distinguisher: '1:1'
                    openconfig-network-instance-ext:route-targets-import:
                      - '100:100'
                      - '101:101'
                    openconfig-network-instance-ext:route-targets-export:
                      - '200:200'
                      - '202:202'
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'BGP'
                        openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'BGP'
                          openconfig-network-instance:name: 'BGP'
                        openconfig-network-instance:bgp:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:as: 1
                            openconfig-network-instance:afi-safis:
                              openconfig-network-instance:afi-safi:
                                - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                    openconfig-network-instance:enabled: true
                          openconfig-network-instance:neighbors:
                            openconfig-network-instance:neighbor:
                              - openconfig-network-instance:neighbor-address: '10.11.11.2'
                                openconfig-network-instance:config:
                                  openconfig-network-instance:neighbor-address: '10.11.11.2'
                                  openconfig-network-instance:peer-as: 2
                                openconfig-network-instance:afi-safis:
                                  openconfig-network-instance:afi-safi:
                                    - openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:afi-safi-name: 'IPV4_UNICAST'
                                        openconfig-network-instance:enabled: true
                                openconfig-network-instance:as-path-options:
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:replace-peer-as: True
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ address-family ipv4 vrf abc:' in changes"
          - "'+  neighbor 10.11.11.2 as-override:' in changes"
