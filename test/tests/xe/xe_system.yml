---
- hosts: nso
  connection: local
  gather_facts: no
  roles:
    - nso-rollback-save
  run_once: true
  vars:
    rollback_file: "{{ lookup('env', 'PWD') }}/rollback.yaml"

- hosts: localhost
  gather_facts: no
  tags:
    - disable_ned_checks
  vars:
    device_name: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
    content: |
      config-warning: 
        - warning: .*
  tasks:
    - name: Convert string to JSON
      set_fact:
        configs: "{{ content | from_yaml | to_json }}"
    - name: JSON configs
      debug:
        msg: "{{ configs }}"
    - name: DISABLE NED checks - For error message from deleting radius server before removing radius server group
      uri:
        url: "http://{{ lookup('env', 'NSO_HOST') }}:8080/restconf/data/tailf-ncs:devices/device={{device_name}}/ned-settings/tailf-ned-cisco-ios-meta:cisco-ios/write/config-warning"
        url_username: "{{ lookup('env', 'NSO_USERNAME') }}"
        url_password: "{{ lookup('env', 'NSO_PASSWORD') }}"
        force_basic_auth: yes
        validate_certs: no
        status_code: [200,201,204]
        method: PATCH
        headers: "{
          'Content-Type': 'application/yang-data+json',
          'Accept': 'application/yang-data+json'}"
        body_format: json
        body: "{{ configs }}"

- name: test system
  hosts: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
  gather_facts: no
  connection: network_cli
  vars:
    device: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
    ansible_network_os: 'cisco.ios.ios'
  tasks:
    - name: test system_config
      tags:
        - system_config
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system:config:
                openconfig-system-ext:enable-secret: 'password'
                openconfig-system-ext:console-exec-timeout-seconds: 800
                openconfig-system:domain-name: 'test123.com'
                openconfig-system:hostname: 'rxx'
                openconfig-system:login-banner: |
                  This is the login-banner.
                openconfig-system:motd-banner: |
                  This is the motd-banner.
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+hostname rxx:' in changes"
          - "'+ip domain name test123.com:' in changes"
          - "'+banner login ^CThis is the login-banner.:' in changes"
          - "'+banner motd ^CThis is the motd-banner.:' in changes"
          - "' line con 0:' in changes"
          - "'+ exec-timeout 13 20:' in changes"

    - name: test ip_option_drop
      tags:
        - ip_option_drop
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system:config:
                openconfig-system-ext:ip-options: 'DROP'
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ip options drop:' in changes"
    - name: test ip_option_ignore
      tags:
        - ip_option_ignore
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system:config:
                openconfig-system-ext:ip-options: 'IGNORE'
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ip options ignore:' in changes"
    - name: test ip_option_enable
      tags:
        - ip_option_enable
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system:config:
                openconfig-system-ext:ip-options: 'ENABLE'
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'-ip options ignore:' in changes"

    - name: test ssh_server
      tags:
        - ssh_server
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 30
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-system:system:
              openconfig-system:ssh-server:
                openconfig-system:config:
                  openconfig-system-ext:absolute-timeout-minutes: 1200
                  openconfig-system-ext:ssh-timeout: 55
                  openconfig-system-ext:ssh-source-interface: 'GigabitEthernet6'
                  openconfig-system:enable: true
                  openconfig-system:protocol-version: 'V2'
                  openconfig-system:session-limit: 16
                  openconfig-system:timeout: 1800
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ absolute-timeout 1200:' in changes"
          - "'+ip ssh time-out 55:' in changes"
          - "'+ip ssh source-interface GigabitEthernet6:' in changes"
          - "'+ip ssh version 2:' in changes"
          - "'+ session-limit 16:' in changes"
          - "'+ exec-timeout 30 0:' in changes"

    - name: test ntp_server
      tags:
        - ntp_server
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 30
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
                - openconfig-interfaces:name: 'GigabitEthernet7'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet7'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.7.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.7.0.1'
                                  openconfig-if-ip:prefix-length: 30
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'  # All interfaces are in default unless listed under other VRF
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
                - openconfig-network-instance:name: 'abc'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'abc'
                    openconfig-network-instance:type: 'L3VRF'  # oc-ni-types:DEFAULT_INSTANCE
                    openconfig-network-instance:enabled: true  # not in IOS
                    openconfig-network-instance:enabled-address-families:
                      - 'IPV4'
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet7'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet7'
                          openconfig-network-instance:interface: 'GigabitEthernet7'
                          openconfig-network-instance:subinterface: 0
            openconfig-system:system:
              openconfig-system:ntp:
                openconfig-system:config:
                  openconfig-system:enabled: true
                  openconfig-system:enable-ntp-auth: true
                  openconfig-system-ext:ntp-enable-logging: true
                  openconfig-system:ntp-source-address: '10.6.0.1'
                openconfig-system:ntp-keys:
                  openconfig-system:ntp-key:
                    - openconfig-system:key-id: 1
                      openconfig-system:config:
                        openconfig-system:key-id: 1
                        openconfig-system:key-type: 'NTP_AUTH_MD5'
                        openconfig-system:key-value: 'password1'
                    - openconfig-system:key-id: 2
                      openconfig-system:config:
                        openconfig-system:key-id: 2
                        openconfig-system:key-type: 'NTP_AUTH_MD5'
                        openconfig-system:key-value: 'password2'
                openconfig-system:servers:
                  openconfig-system:server:
                    - openconfig-system:address: '10.0.0.1'
                      openconfig-system:config:
                        openconfig-system-ext:ntp-auth-key-id: 1
                        openconfig-system-ext:ntp-use-vrf: 'default'
                        openconfig-system:address: '10.0.0.1'
                        openconfig-system:association-type: 'SERVER'  # SERVER, PEER, POOL
                        openconfig-system:iburst: true
                        openconfig-system:port: 123  # always 123 for ios
                        openconfig-system:prefer: false
                        openconfig-system:version: 4
                    - openconfig-system:address: '10.0.0.2'
                      openconfig-system:config:
                        openconfig-system-ext:ntp-auth-key-id: 2
                        openconfig-system-ext:ntp-use-vrf: 'abc'
                        openconfig-system:address: '10.0.0.2'
                        openconfig-system:association-type: 'PEER'
                        openconfig-system:iburst: true
                        openconfig-system:port: 123  # always 123 for ios
                        openconfig-system:prefer: false
                        openconfig-system:version: 4
                    - openconfig-system:address: '10.0.0.3'
                      openconfig-system:config:
                        openconfig-system-ext:ntp-auth-key-id: 1
                        openconfig-system-ext:ntp-source-address: '10.6.0.1'
                        openconfig-system:address: '10.0.0.3'
                        openconfig-system:association-type: 'SERVER'  # SERVER, PEER, POOL
                        openconfig-system:iburst: true
                        openconfig-system:port: 123  # always 123 for ios
                        openconfig-system:prefer: true
                        openconfig-system:version: 3
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ntp authenticate:' in changes"
          - "'+ntp logging:' in changes"
          - "'+ntp source GigabitEthernet6:' in changes"
          - "'+ntp server 10.0.0.1 key 1:' in changes"
          - "'+ntp peer vrf abc 10.0.0.2 key 2:' in changes"
          - "'+ntp trusted-key 1:' in changes"
          - "'+ntp trusted-key 2:' in changes"
          - "'+ntp server 10.0.0.1 key 1:' in changes"
          - "'+ntp peer vrf abc 10.0.0.2 key 2:' in changes"
          - "'+ntp server 10.0.0.3 key 1 prefer source GigabitEthernet6 version 3:' in changes"
#Hashes Change#          - "'+ntp authentication-key 1 md5 044B0A151C36435C0D48 7:' in changes"  #Hashes Change
#Hashes Change#          - "'+ntp authentication-key 2 md5 071F205F5D1E16171340 7:' in changes"

    - name: test logging_server
      tags:
        - logging_server
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 30
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
                - openconfig-interfaces:name: 'GigabitEthernet7'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet7'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.7.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.7.0.1'
                                  openconfig-if-ip:prefix-length: 30
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'  # All interfaces are in default unless listed under other VRF
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                - openconfig-network-instance:name: 'abc'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'abc'
                    openconfig-network-instance:type: 'L3VRF'  # oc-ni-types:DEFAULT_INSTANCE
                    openconfig-network-instance:enabled: true  # not in IOS
                    openconfig-network-instance:enabled-address-families:
                      - 'IPV4'
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet7'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet7'
                          openconfig-network-instance:interface: 'GigabitEthernet7'
                          openconfig-network-instance:subinterface: 0
            openconfig-system:system:
              openconfig-system:logging:  # facility must be same for all in IOS
                openconfig-system:console:  # set console
                  openconfig-system:config: { }
                  openconfig-system:selectors:
                    openconfig-system:selector:
                      - openconfig-system:facility: 'SYSLOG'
                        openconfig-system:severity: 'INFORMATIONAL'
                        openconfig-system:config:
                          openconfig-system:facility: 'SYSLOG'
                          openconfig-system:severity: 'INFORMATIONAL'  # logging console
                openconfig-system-ext:terminal-monitor: # set monitor
                  openconfig-system-ext:selectors:
                    openconfig-system-ext:selector:
                      - openconfig-system-ext:facility: 'SYSLOG'
                        openconfig-system-ext:severity: 'ALERT'
                        openconfig-system-ext:config:
                          openconfig-system-ext:facility: 'SYSLOG'
                          openconfig-system-ext:severity: 'ALERT'  # logging monitor
                openconfig-system:remote-servers:
                  openconfig-system:remote-server:
                    - openconfig-system:host: '10.0.0.1'
                      openconfig-system:config:
                        openconfig-system:host: '10.0.0.1'  # logging host x.x.x.x
                        openconfig-system:remote-port: 514
                        openconfig-system:source-address: '10.7.0.1'
                        openconfig-system-ext:use-vrf: 'abc'
                      openconfig-system:selectors:
                        openconfig-system:selector:
                          - openconfig-system:facility: 'SYSLOG'
                            openconfig-system:severity: 'CRITICAL'
                            openconfig-system:config:
                              openconfig-system:facility: 'SYSLOG'
                              openconfig-system:severity: 'CRITICAL'
                    - openconfig-system:host: '10.0.0.2'
                      openconfig-system:config:
                        openconfig-system:host: '10.0.0.2'  # logging host x.x.x.x
                        openconfig-system:remote-port: 514
                        openconfig-system:source-address: '10.6.0.1'
                        openconfig-system-ext:use-vrf: 'default'
                      openconfig-system:selectors:
                        openconfig-system:selector:
                          - openconfig-system:facility: 'SYSLOG'
                            openconfig-system:severity: 'CRITICAL'
                            openconfig-system:config:
                              openconfig-system:facility: 'SYSLOG'
                              openconfig-system:severity: 'CRITICAL'
                    - openconfig-system:host: '10.0.0.3'
                      openconfig-system:config:
                        openconfig-system:host: '10.0.0.3'  # logging host x.x.x.x
                        openconfig-system:remote-port: 514
                        openconfig-system:source-address: '10.6.0.1'
                      openconfig-system:selectors:
                        openconfig-system:selector:
                          - openconfig-system:facility: 'SYSLOG'
                            openconfig-system:severity: 'CRITICAL'
                            openconfig-system:config:
                              openconfig-system:facility: 'SYSLOG'
                              openconfig-system:severity: 'CRITICAL'
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+logging console informational:' in changes"
          - "'+logging monitor alerts:' in changes"
          - "'+logging trap critical:' in changes"
          - "'+logging facility syslog:' in changes"
          - "'+logging host 10.0.0.1 vrf abc:' in changes"
          - "'+logging source-interface GigabitEthernet7 vrf abc:' in changes"
          - "'+logging host 10.0.0.2:' in changes"
          - "'+logging host 10.0.0.3:' in changes"
          - "'+logging source-interface GigabitEthernet6:' in changes"

    - name: test dns-servers
      tags:
        - dns-servers
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'  # All interfaces are in default unless listed under other VRF
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                - openconfig-network-instance:name: 'abc'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'abc'
                    openconfig-network-instance:type: 'L3VRF'  # oc-ni-types:DEFAULT_INSTANCE
                    openconfig-network-instance:enabled: true  # not in IOS
                    openconfig-network-instance:enabled-address-families:
                      - 'IPV4'
            openconfig-system:system:
              openconfig-system:dns:
                openconfig-system:servers:
                  openconfig-system:server:
                    - openconfig-system:address: '8.8.8.8'
                      openconfig-system:config:
                        openconfig-system:address: '8.8.8.8'
                        openconfig-system:port: 53  # always 53 for ios
                    - openconfig-system:address: '8.8.4.4'
                      openconfig-system:config:
                        openconfig-system:address: '8.8.4.4'
                        openconfig-system:port: 53  # always 53 for ios
                    - openconfig-system:address: '8.8.5.5'
                      openconfig-system:config:
                        openconfig-system:address: '8.8.5.5'
                        openconfig-system:port: 53  # always 53 for ios
                        openconfig-system-ext:use-vrf: 'abc'
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ip name-server 8.8.8.8 8.8.4.4:' in changes"
          - "'+ip name-server vrf abc 8.8.5.5:' in changes"

    - name: test clock_timezone
      tags:
        - clock_timezone
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system:clock:
                openconfig-system:config:
                  openconfig-system:timezone-name: 'CST -6 0'
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+clock timezone CST -6 0:' in changes"

- name: test system
  hosts: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
  gather_facts: no
  connection: network_cli
  vars:
    device: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
    ansible_network_os: 'cisco.ios.ios'
  tasks:
    - name: test http_server
      tags:
        - http_server
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:http:
                  openconfig-system-ext:config:
                    openconfig-system-ext:http-enabled: true
                    openconfig-system-ext:https-enabled: true
                    openconfig-system-ext:ip-http-max-connections: 4
                    openconfig-system-ext:ip-http-secure-ciphersuite:
                      - 'aes-256-cbc-sha'
                      - 'aes-128-cbc-sha'
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ip http secure-server:' in changes"
          - "'+ip http server:' in changes"
          - "'+ip http max-connections 4:' in changes"
          - "'+ip http secure-ciphersuite aes-128-cbc-sha aes-256-cbc-sha:' in changes"
    - name: test http_server
      tags:
        - http_server
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:http:
                  openconfig-system-ext:config:
                    openconfig-system-ext:http-enabled: false
                    openconfig-system-ext:https-enabled: false
        api_method: PATCH
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+no ip http secure-server:' in changes"
          - "'+no ip http server:' in changes"
    - name: test finger_service
      tags:
        - finger_service
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:config:
                  openconfig-system-ext:finger: true
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ip finger:' in changes"
    - name: test set_up
      tags:
        - set_up
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:config:
                  openconfig-system-ext:finger: false
        api_method: PATCH
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'-ip finger:' in changes"

- name: test system
  hosts: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
  gather_facts: no
  connection: network_cli
  vars:
    device: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
    ansible_network_os: 'cisco.ios.ios'
  tasks:
    - name: test http_timeout_policy
      tags:
        - http_timeout_policy
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:http:
                  openconfig-system-ext:ip-http-timeout-policy:
                    openconfig-system-ext:idle:
                      openconfig-system-ext:config:
                        openconfig-system-ext:connection: 240
                        openconfig-system-ext:life: 240
                        openconfig-system-ext:requests: 3
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ip http timeout-policy idle 240 life 240 requests 3:' in changes"

    - name: test timestamps_datetime
      tags:
        - timestamps_datetime
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:timestamps:
                openconfig-system-ext:logging:
                  openconfig-system-ext:config:
                    openconfig-system-ext:enabled: true
                    openconfig-system-ext:datetime: true
                    openconfig-system-ext:uptime: false
                    openconfig-system-ext:localtime: true
                openconfig-system-ext:debugging:
                  openconfig-system-ext:config:
                    openconfig-system-ext:enabled: true
                    openconfig-system-ext:datetime: true
                    openconfig-system-ext:uptime: false
                    openconfig-system-ext:localtime: true
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+service timestamps debug datetime msec localtime:' in changes"
          - "'+service timestamps log datetime msec localtime:' in changes"

    - name: test timestamps_uptime
      tags:
        - timestamps_uptime
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:timestamps:
                openconfig-system-ext:logging:
                  openconfig-system-ext:config:
                    openconfig-system-ext:enabled: true
                    openconfig-system-ext:datetime: false
                    openconfig-system-ext:uptime: true
                    openconfig-system-ext:localtime: true
                openconfig-system-ext:debugging:
                  openconfig-system-ext:config:
                    openconfig-system-ext:enabled: true
                    openconfig-system-ext:datetime: false
                    openconfig-system-ext:uptime: true
                    openconfig-system-ext:localtime: true
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+service timestamps debug uptime:' in changes"
          - "'+service timestamps log uptime:' in changes"

    - name: test console-and-monitor-severity-emergency
      tags:
        - console-and-monitor-severity-emergency
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system:logging:  # facility must be same for all in IOS
                openconfig-system:console:  # set console and monitor
                  openconfig-system:config: { }
                  openconfig-system:selectors:
                    openconfig-system:selector:
                      - openconfig-system:facility: 'SYSLOG'
                        openconfig-system:severity: 'EMERGENCY'
                        openconfig-system:config:
                          openconfig-system:facility: 'SYSLOG'
                          openconfig-system:severity: 'EMERGENCY'
                openconfig-system-ext:terminal-monitor:
                  openconfig-system-ext:selectors:
                    openconfig-system-ext:selector:
                      - openconfig-system-ext:facility: 'SYSLOG'
                        openconfig-system-ext:severity: 'EMERGENCY'
                        openconfig-system-ext:config:
                          openconfig-system-ext:facility: 'SYSLOG'
                          openconfig-system-ext:severity: 'EMERGENCY'
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+logging facility syslog:' in changes"
          - "'+logging console emergencies:' in changes"
          - "'+logging monitor emergencies:' in changes"

    - name: test remote-servers-severity-emergency
      tags:
        - remote-servers-severity-emergency
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system:logging:  # facility must be same for all in IOS
                openconfig-system:remote-servers:
                  openconfig-system:remote-server:
                    - openconfig-system:host: '10.0.0.1'
                      openconfig-system:config:
                        openconfig-system:host: '10.0.0.1'  # logging host x.x.x.x
                        openconfig-system:remote-port: 514
                      openconfig-system:selectors:
                        openconfig-system:selector:
                          - openconfig-system:facility: 'SYSLOG'
                            openconfig-system:severity: 'EMERGENCY'
                            openconfig-system:config:
                              openconfig-system:facility: 'SYSLOG'
                              openconfig-system:severity: 'EMERGENCY'
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+logging trap emergencies:' in changes"

    - name: test any-emergency
      tags:
        - any-emergency
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system:logging:  # facility must be same for all in IOS
                openconfig-system:console:  # set console and monitor
                  openconfig-system:config: { }
                  openconfig-system:selectors:
                    openconfig-system:selector:
                      - openconfig-system:facility: 'SYSLOG'
                        openconfig-system:severity: 'CRITICAL'
                        openconfig-system:config:
                          openconfig-system:facility: 'SYSLOG'
                          openconfig-system:severity: 'CRITICAL'
                openconfig-system-ext:terminal-monitor:  # set console and monitor
                  openconfig-system-ext:selectors:
                    openconfig-system-ext:selector:
                      - openconfig-system-ext:facility: 'SYSLOG'
                        openconfig-system-ext:severity: 'CRITICAL'
                        openconfig-system-ext:config:
                          openconfig-system-ext:facility: 'SYSLOG'
                          openconfig-system-ext:severity: 'CRITICAL'
                openconfig-system:remote-servers:
                  openconfig-system:remote-server:
                    - openconfig-system:host: '10.0.0.1'
                      openconfig-system:config:
                        openconfig-system:host: '10.0.0.1'  # logging host x.x.x.x
                        openconfig-system:remote-port: 514
                      openconfig-system:selectors:
                        openconfig-system:selector:
                          - openconfig-system:facility: 'SYSLOG'
                            openconfig-system:severity: 'ERROR'
                            openconfig-system:config:
                              openconfig-system:facility: 'SYSLOG'
                              openconfig-system:severity: 'ERROR'
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+logging console critical:' in changes"
          - "'+logging monitor critical:' in changes"
          - "'+logging trap errors:' in changes"

    - name: test aaa-all
      tags:
        - aaa-all
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 30
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-system:system:
              openconfig-system:config:
                openconfig-system-ext:enable-secret: 'admin'
              openconfig-system:aaa:
                openconfig-system:accounting:
                  openconfig-system:config:
                    openconfig-system:accounting-method:  # group name, TACACS_ALL
                      - 'TACACS-GROUP-1'
                      - 'TACACS_ALL'
                  openconfig-system:events:
                    openconfig-system:event:  # OC supports command and login
                      - openconfig-system:event-type: 'AAA_ACCOUNTING_EVENT_LOGIN'
                        openconfig-system:config:
                          openconfig-system:event-type: 'AAA_ACCOUNTING_EVENT_LOGIN'  # IOS aaa accounting exec for ios
                          openconfig-system:record: 'STOP'  # or START_STOP
                      - openconfig-system:event-type: 'AAA_ACCOUNTING_EVENT_COMMAND'
                        openconfig-system:config:
                          openconfig-system:event-type: 'AAA_ACCOUNTING_EVENT_COMMAND'  # IOS aaa accounting commanda and priv 15
                          openconfig-system:record: 'STOP'  # or START_STOP
                openconfig-system:authentication:
                  openconfig-system:admin-user:
                    openconfig-system:config:
                      openconfig-system:admin-password: 'admin'
                      openconfig-system:admin-password-hashed: ''
                  openconfig-system:config:
                    openconfig-system:authentication-method:
                      - 'LOCAL'
                  openconfig-system:users:
                    openconfig-system:user:
                      - openconfig-system:username: 'user1'
                        openconfig-system:config:
                          openconfig-system:username: 'user1'
                          openconfig-system:password: 'Password123'
                          openconfig-system:password-hashed: ''
                          openconfig-system:role: 'SYSTEM_ROLE_ADMIN'  # This is the one role in model
                          openconfig-system:ssh-key: ''
                      - openconfig-system:username: 'user2'
                        openconfig-system:config:
                          openconfig-system:username: 'user2'
                          openconfig-system:password: 'Password123'
                          openconfig-system:password-hashed: ''
                          openconfig-system:role: 'SYSTEM_ROLE_ADMIN'  # This is the one role in model
                          openconfig-system:ssh-key: ''
                openconfig-system:authorization:
                  openconfig-system:config:
                    openconfig-system:authorization-method:
          #                - 'TACACS_ALL'
                      - 'LOCAL'
                  openconfig-system:events:
                    openconfig-system:event:
                      - openconfig-system:event-type: 'AAA_AUTHORIZATION_EVENT_CONFIG'
                        openconfig-system:config:
                          openconfig-system:event-type: 'AAA_AUTHORIZATION_EVENT_CONFIG'  # Specifies configuration (e.g., EXEC) events for AAA
          #                - openconfig-system:config:
          #                    openconfig-system:event-type: 'AAA_AUTHORIZATION_EVENT_COMMAND'  # Specifies interactive command events for AAA authorization
          #                  openconfig-system:event-type: 'AAA_AUTHORIZATION_EVENT_COMMAND'
                openconfig-system:config: { }
                openconfig-system:server-groups:
                  openconfig-system:server-group:
                    - openconfig-system:name: 'TACACS-GROUP-1'
                      openconfig-system:config:
                        openconfig-system:name: 'TACACS-GROUP-1'
                        openconfig-system:type: 'TACACS'
                      openconfig-system:servers:
                        openconfig-system:server:
                          - openconfig-system:address: '10.1.1.1'
                            openconfig-system:config:
                              openconfig-system:address: '10.1.1.1'
                              openconfig-system:name: 'TACACSSVR1'
                              openconfig-system:timeout: 10
                            openconfig-system:tacacs:
                              openconfig-system:config:
                                openconfig-system:port: 49
                                openconfig-system:secret-key: 'Password123'
                                openconfig-system:source-address: '10.6.0.1'  # For each group, sources must be the same
                          - openconfig-system:address: '10.2.2.2'
                            openconfig-system:config:
                              openconfig-system:address: '10.2.2.2'
                              openconfig-system:name: 'TACACSSVR2'
                              openconfig-system:timeout: 10
                            openconfig-system:tacacs:
                              openconfig-system:config:
                                openconfig-system:port: 49
                                openconfig-system:secret-key: 'Password123'
                                openconfig-system:source-address: '10.6.0.1'  # For each group, sources must be the same
                    - openconfig-system:name: 'TACACS-GROUP-2'
                      openconfig-system:config:
                        openconfig-system:name: 'TACACS-GROUP-2'
                        openconfig-system:type: 'TACACS'
                      openconfig-system:servers:
                        openconfig-system:server:
                          - openconfig-system:address: '10.3.3.3'
                            openconfig-system:config:
                              openconfig-system:address: '10.3.3.3'
                              openconfig-system:name: 'TACACSSVR3'
                              openconfig-system:timeout: 10
                            openconfig-system:tacacs:
                              openconfig-system:config:
                                openconfig-system:port: 49
                                openconfig-system:secret-key: 'Password123'
                                openconfig-system:source-address: '10.6.0.1'  # For each group, sources must be the same
                          - openconfig-system:address: '10.4.4.4'
                            openconfig-system:config:
                              openconfig-system:address: '10.4.4.4'
                              openconfig-system:name: 'TACACSSVR4'
                              openconfig-system:timeout: 10
                            openconfig-system:tacacs:
                              openconfig-system:config:
                                openconfig-system:port: 49
                                openconfig-system:secret-key: 'Password123'
                                openconfig-system:source-address: '10.6.0.1'  # For each group, sources must be the same
                    - openconfig-system:name: 'RADIUS-GROUP-1'
                      openconfig-system:config:
                        openconfig-system:name: 'RADIUS-GROUP-1'
                        openconfig-system:type: 'RADIUS'
                      openconfig-system:servers:
                        openconfig-system:server:
                          - openconfig-system:address: '10.5.5.5'
                            openconfig-system:config:
                              openconfig-system:address: '10.5.5.5'
                              openconfig-system:name: 'RADIUSSVR1'
                              openconfig-system:timeout: 10
                            openconfig-system:radius:
                              openconfig-system:config:
                                openconfig-system:acct-port: 1853
                                openconfig-system:auth-port: 1852
                                openconfig-system:secret-key: 'Password123'
                                openconfig-system:source-address: '10.6.0.1'  # For each group, sources must be the same
                          - openconfig-system:address: '10.6.6.6'
                            openconfig-system:config:
                              openconfig-system:address: '10.6.6.6'
                              openconfig-system:name: 'RADIUSSVR2'
                              openconfig-system:timeout: 10
                            openconfig-system:radius:
                              openconfig-system:config:
                                openconfig-system:acct-port: 1853
                                openconfig-system:auth-port: 1852
                                openconfig-system:secret-key: 'Password123'
                                openconfig-system:source-address: '10.6.0.1'  # For each group, sources must be the same
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+aaa new-model:' in changes"
          - "'+aaa accounting commands 15 default stop-only group TACACS-GROUP-1 group tacacs+:' in changes"
          - "'+aaa accounting exec default stop-only group TACACS-GROUP-1 group tacacs+:' in changes"
          - "'+aaa authentication login default local:' in changes"
          - "'+aaa authorization exec default local:' in changes"
          - "'+aaa group server tacacs+ TACACS-GROUP-1:' in changes"
          - "'+ server name TACACSSVR1:' in changes"
          - "'+ server name TACACSSVR2:' in changes"
          - "'+ ip tacacs source-interface GigabitEthernet6:' in changes"
          - "'+aaa group server tacacs+ TACACS-GROUP-2:' in changes"
          - "'+ server name TACACSSVR3:' in changes"
          - "'+ server name TACACSSVR4:' in changes"
          - "'+ ip tacacs source-interface GigabitEthernet6:' in changes"
          - "'+tacacs server TACACSSVR1:' in changes"
          - "'+ address ipv4 10.2.2.2:' in changes"
          - "'+ key Password123:' in changes"
          - "'+tacacs server TACACSSVR2:' in changes"
          - "'+ address ipv4 10.2.2.2:' in changes"
          - "'+ key Password123:' in changes"
          - "'+tacacs server TACACSSVR3:' in changes"
          - "'+ address ipv4 10.3.3.3:' in changes"
          - "'+ key Password123:' in changes"
          - "'+tacacs server TACACSSVR4:' in changes"
          - "'+ address ipv4 10.4.4.4:' in changes"
          - "'+ key Password123:' in changes"
          - "'+aaa group server radius RADIUS-GROUP-1:' in changes"
          - "'+ server name RADIUSSVR1:' in changes"
          - "'+ server name RADIUSSVR2:' in changes"
          - "'+ ip radius source-interface GigabitEthernet6:' in changes"
          - "'+radius server RADIUSSVR1:' in changes"
          - "'+ address ipv4 10.5.5.5 auth-port 1852 acct-port 1853:' in changes"
          - "'+ key Password123:' in changes"
          - "'+radius server RADIUSSVR2:' in changes"
          - "'+ address ipv4 10.6.6.6 auth-port 1852 acct-port 1853:' in changes"
          - "'+ key Password123:' in changes"
#          - "'+username admin privilege 15 secret 0 admin:' in changes"  # passwords will be hashed
#          - "'+username user1 privilege 15 secret 0 Password123:' in changes"
#          - "'+username user2 privilege 15 secret 0 Password123:' in changes"

# xe1(config)#no radius server RADIUSSVR1
#xe1(config)#
#*Feb 24 21:44:33.502: %RADIUS-4-SERVREFNAME: Warning: Server RADIUSSVR1 is still referenced by server group.
# Command still works hence disregarding NED errors at the top of file

    - name: test aaa-authentication-login-lists
      tags:
        - aaa-authentication-login-lists
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system:config:
                openconfig-system-ext:enable-secret: 'admin'
              openconfig-system:aaa:
                openconfig-system:authentication:
                  openconfig-system:admin-user:
                    openconfig-system:config:
                      openconfig-system:admin-password: 'admin'
                      openconfig-system:admin-password-hashed: ''
                  openconfig-system:config:
                    openconfig-system:authentication-method:
                      - 'LOCAL'
                  openconfig-system-ext:authentication-lists-login:
                    openconfig-system-ext:config:
                      openconfig-system-ext:name: 'USETACACS'
                      openconfig-system-ext:authentication-method: 
                        - 'LOCAL'
        api_method: PATCH
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+aaa authentication login USETACACS local:' in changes"

- name: test services
  hosts: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
  gather_facts: no
  connection: network_cli
  vars:
    device: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
    ansible_network_os: 'cisco.ios.ios'
  tasks:
    - name: test tcp_udp_gratuitous_arp_password_encryption configuration
      tags:
        - tcp_udp_gratuitous_arp_password_encryption
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:config:
                  openconfig-system-ext:ip-gratuitous-arps: true
                  openconfig-system-ext:service-password-encryption: true
                  openconfig-system-ext:service-tcp-small-servers: true
                  openconfig-system-ext:service-udp-small-servers: true
        api_method: PUT
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ip gratuitous-arps:' in changes"
          - "'+service password-encryption:' in changes"
          - "'+service tcp-small-servers:' in changes"
          - "'+service udp-small-servers:' in changes"

- name: test services
  hosts: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
  gather_facts: no
  connection: network_cli
  vars:
    device: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
    ansible_network_os: 'cisco.ios.ios'
  tasks:
    - name: test no_tcp_udp_gratuitous_arp_password_encryption configuration
      tags:
        - no_tcp_udp_gratuitous_arp_password_encryption
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:config:
                  openconfig-system-ext:ip-gratuitous-arps: false
                  openconfig-system-ext:service-password-encryption: false
                  openconfig-system-ext:service-tcp-small-servers: false
                  openconfig-system-ext:service-udp-small-servers: false
                  openconfig-system-ext:finger: true
        api_method: PATCH
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'-ip gratuitous-arps:' in changes"
          - "'-service password-encryption:' in changes"
          - "'-service tcp-small-servers:' in changes"
          - "'-service udp-small-servers:' in changes"

    - name: test logging_buffered
      tags:
        - logging_buffered
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system:logging:
               openconfig-system-ext:buffered:
                  openconfig-system-ext:config:
                      openconfig-system-ext:enabled: true
                      openconfig-system-ext:severity: 'INFORMATIONAL'
                      openconfig-system-ext:buffer-size: 200000
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+logging buffered 200000 informational:' in changes"

    - name: test logging_buffered
      tags:
        - logging_buffered
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system:logging:
               openconfig-system-ext:buffered:
                  openconfig-system-ext:config:
                      openconfig-system-ext:enabled: false
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+no logging buffered:' in changes"

    - name: test no_logging_console
      tags:
        - no_logging_console
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system:logging:
               openconfig-system:console:
                 openconfig-system:config:
                   openconfig-system-ext:enabled: false
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+no logging console:' in changes"

    - name: test no_ip_domain_lookup
      tags:
        - no_ip_domain_lookup
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:config:
                  openconfig-system-ext:ip-domain-lookup: false
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+no ip domain lookup:' in changes"

    - name: test no_login_on_success
      tags:
        - no_login_on_success
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:login-security-policy:
                  openconfig-system-ext:config:
                    openconfig-system-ext:on-success: false
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+no login on-success log:' in changes"

    - name: test login_on_success
      tags:
        - login_on_success
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:login-security-policy:
                  openconfig-system-ext:config:
                    openconfig-system-ext:on-success: true
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+login on-success log:' in changes"

    - name: test login_on_failure
      tags:
        - login_on_failure
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:login-security-policy:
                  openconfig-system-ext:config:
                    openconfig-system-ext:on-failure: true
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+login on-failure log:' in changes"

    - name: test block_for
      tags:
        - block_for
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:login-security-policy:
                  openconfig-system-ext:block-for:
                    openconfig-system-ext:config:
                      openconfig-system-ext:seconds: 900
                      openconfig-system-ext:attempts: 3
                      openconfig-system-ext:within: 120
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+login block-for 900 attempts 3 within 120:' in changes"

    - name: test archive_logging
      tags:
        - archive_logging
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:config:
                  openconfig-system-ext:archive-logging: true
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+archive:' in changes"
          - "'+ log config:' in changes"
          - "'+  logging enable:' in changes"

    - name: apply boot network
      tags:
        - boot_network
      import_role:
        name: nso-ned-device-configure
      vars:
        api_path: config/tailf-ned-cisco-ios:boot
        content: |
          tailf-ned-cisco-ios:boot:
            network:
              list:
                - protocol: ftp
                  filename: ftp
                  address: 255.255.255.255
                - protocol: rcp
                  filename: rcp
                  address: 255.255.255.255
                - protocol: tftp
                  filename: tftphost
                  address: 255.255.255.255
                - protocol: tftp
                  filename: word
                  address: 255.255.255.255
              list-flash:
                flash:
                  - name: flash
              remote-url: "mop:unknown"
        api_method: PATCH

    - name: test no_boot_network
      tags:
        - no_boot_network
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:boot-network:
                  openconfig-system-ext:config:
                    openconfig-system-ext:bootnetwork-enabled: DISABLED
        api_method: PATCH
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: true
        assertions:
          - "'-boot network flash flash:' in changes"
          - "'-boot network ftp ftp 255.255.255.255:' in changes"
          - "'-boot network rcp rcp 255.255.255.255:' in changes"
          - "'-boot network tftp tftphost 255.255.255.255:' in changes"
          - "'-boot network tftp word 255.255.255.255:' in changes"
          - "'-boot network mop:unknown:' in changes"

    - name: test ip_bootp_server
      tags:
        - ip_bootp_server
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:config:
                  openconfig-system-ext:ip-bootp-server: true
        api_method: PATCH
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ip bootp server:' in changes"

    - name: test ip_dns_server
      tags:
        - ip_dns_server
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:config:
                  openconfig-system-ext:ip-dns-server: true
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ip dns server:' in changes"

    - name: test ip_identd
      tags:
        - ip_identd
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:config:
                  openconfig-system-ext:ip-identd: true
        api_method: PATCH
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ip identd:' in changes"

    - name: test ip_rcmd_rcp_enable
      tags:
        - ip_rcmd_rcp_enable
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:config:
                  openconfig-system-ext:ip-rcmd-rcp-enable: true
        api_method: PATCH
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ip rcmd rcp-enable:' in changes"

    - name: test ip_rcmd_rsh_enable
      tags:
        - ip_rcmd_rsh_enable
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:config:
                  openconfig-system-ext:ip-rcmd-rsh-enable: true
        api_method: PATCH
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ip rcmd rsh-enable:' in changes"

    - name: test service_config
      tags:
        - service_config
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:config:
                  openconfig-system-ext:service-config: true
        api_method: PATCH
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+service config:' in changes"

    - name: test service_pad
      tags:
        - service_pad
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:config:
                  openconfig-system-ext:service-pad: true
        api_method: PATCH
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+service pad:' in changes"

    - name: test password-encryption
      tags:
        - password-encryption
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:config:
                  openconfig-system-ext:service-password-encryption: true
        api_method: PATCH
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+service password-encryption:' in changes"

    - name: test ssh algorithm encryption (All Alg)
      tags:
        - ssh-algorithm-encryption-all
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system:ssh-server:
                openconfig-system-ext:algorithm:
                  openconfig-system-ext:config:
                    openconfig-system-ext:encryption:
                      - aes128-ctr
                      - aes192-ctr
                      - aes256-ctr
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ip ssh server algorithm encryption aes256-ctr aes192-ctr aes128-ctr:' in changes"

    - name: test ssh algorithm mac (2 Alg)
      tags:
        - ssh-algorithm-mac-2
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system:ssh-server:
                openconfig-system-ext:algorithm:
                  openconfig-system-ext:config:
                    openconfig-system-ext:mac:
                      - hmac-sha2-256
                      - hmac-sha2-512
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+ip ssh server algorithm mac hmac-sha2-256 hmac-sha2-512:' in changes"

    - name: test track_object
      tags:
        - track_object
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet2'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet2'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                - openconfig-interfaces:name: 'GigabitEthernet3'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet3'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:object-tracking:
                  openconfig-system-ext:config:
                    openconfig-system-ext:timer:
                      openconfig-system-ext:interface-timer: 567
                  openconfig-system-ext:object-track:
                    - openconfig-system-ext:id: 100
                      openconfig-system-ext:type: INTERFACE
                      openconfig-system-ext:config:
                        openconfig-system-ext:id: 100
                        openconfig-system-ext:track-interface: GigabitEthernet2
                        openconfig-system-ext:track-parameter: LINE-PROTOCOL
                    - openconfig-system-ext:id: 101
                      openconfig-system-ext:type: INTERFACE
                      openconfig-system-ext:config:
                        openconfig-system-ext:id: 101
                        openconfig-system-ext:track-interface: GigabitEthernet3
                        openconfig-system-ext:track-parameter: IP-ROUTING
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+track timer interface 567:' in changes"
          - "'+track 100 interface GigabitEthernet2 line-protocol:' in changes"
          - "'+track 101 interface GigabitEthernet3 ip routing:' in changes"

    - name: test key_chain
      tags:
        - key_chain
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:key-chains:
                  openconfig-system-ext:key-chain:
                    - openconfig-system-ext:name: OSPF_KEYCHAIN1
                      openconfig-system-ext:type: NOT_APPLICABLE
                      openconfig-system-ext:keys:
                        - openconfig-system-ext:id: 10
                          openconfig-system-ext:config:
                            openconfig-system-ext:id: 10
                            openconfig-system-ext:key-string: "cisco"
                            openconfig-system-ext:cryptographic-algorithm: "hmac-sha-1"
                            openconfig-system-ext:accept-lifetime:
                              openconfig-system-ext:start-time: "00:00:00"
                              openconfig-system-ext:start-month: "Jan"
                              openconfig-system-ext:start-date: 1
                              openconfig-system-ext:start-year: 2023
                              openconfig-system-ext:duration: 364
                            openconfig-system-ext:send-lifetime:
                              openconfig-system-ext:start-time: "00:00:01"
                              openconfig-system-ext:start-month: "Feb"
                              openconfig-system-ext:start-date: 2
                              openconfig-system-ext:start-year: 2024
                              openconfig-system-ext:duration: 365
                        - openconfig-system-ext:id: 20
                          openconfig-system-ext:config:
                            openconfig-system-ext:id: 20
                            openconfig-system-ext:key-string: "cisco"
                            openconfig-system-ext:cryptographic-algorithm: "hmac-sha-512"
                            openconfig-system-ext:accept-lifetime:
                              openconfig-system-ext:start-time: "01:00:00"
                              openconfig-system-ext:start-month: "Mar"
                              openconfig-system-ext:start-date: 2
                              openconfig-system-ext:start-year: 2023
                              openconfig-system-ext:stop-time: "02:00:00"
                              openconfig-system-ext:stop-month: "Jan"
                              openconfig-system-ext:stop-date: 3
                              openconfig-system-ext:stop-year: 2024
                            openconfig-system-ext:send-lifetime:
                              openconfig-system-ext:start-time: "03:00:01"
                              openconfig-system-ext:start-month: "Apr"
                              openconfig-system-ext:start-date: 4
                              openconfig-system-ext:start-year: 2025
                              openconfig-system-ext:stop-time: "04:00:00"
                              openconfig-system-ext:stop-month: "Aug"
                              openconfig-system-ext:stop-date: 5
                              openconfig-system-ext:stop-year: 2026
                        - openconfig-system-ext:id: 30
                          openconfig-system-ext:config:
                            openconfig-system-ext:id: 30
                            openconfig-system-ext:key-string: "cisco"
                            openconfig-system-ext:cryptographic-algorithm: "hmac-sha-512"
                            openconfig-system-ext:accept-lifetime:
                              openconfig-system-ext:local:
                                openconfig-system-ext:start-time: "03:30:00"
                                openconfig-system-ext:start-month: "Mar"
                                openconfig-system-ext:start-date: 20
                                openconfig-system-ext:start-year: 2024
                                openconfig-system-ext:stop-time: "02:00:00"
                                openconfig-system-ext:stop-month: "Jan"
                                openconfig-system-ext:stop-date: 21
                                openconfig-system-ext:stop-year: 2025
                            openconfig-system-ext:send-lifetime:
                              openconfig-system-ext:local:
                                openconfig-system-ext:start-time: "04:30:01"
                                openconfig-system-ext:start-month: "Apr"
                                openconfig-system-ext:start-date: 15
                                openconfig-system-ext:start-year: 2027
                                openconfig-system-ext:infinite: false
                                openconfig-system-ext:stop-time: "04:00:00"
                                openconfig-system-ext:stop-month: "Aug"
                                openconfig-system-ext:stop-date: 16
                                openconfig-system-ext:stop-year: 2028
                        - openconfig-system-ext:id: 40
                          openconfig-system-ext:config:
                            openconfig-system-ext:id: 40
                            openconfig-system-ext:key-string: "cisco"
                            openconfig-system-ext:cryptographic-algorithm: "hmac-sha-256"
                            openconfig-system-ext:accept-lifetime:
                              openconfig-system-ext:local:
                                openconfig-system-ext:start-time: "23:30:00"
                                openconfig-system-ext:start-month: "Dec"
                                openconfig-system-ext:start-date: 1
                                openconfig-system-ext:start-year: 2024
                                openconfig-system-ext:infinite: true
                            openconfig-system-ext:send-lifetime:
                              openconfig-system-ext:local:
                                openconfig-system-ext:start-time: "23:30:01"
                                openconfig-system-ext:start-month: "Dec"
                                openconfig-system-ext:start-date: 31
                                openconfig-system-ext:start-year: 2028
                                openconfig-system-ext:infinite: true
                    - openconfig-system-ext:name: BGP-TCP_KEYCHAIN1
                      openconfig-system-ext:type: TCP
                      openconfig-system-ext:keys:
                        - openconfig-system-ext:id: 10
                          openconfig-system-ext:config:
                            openconfig-system-ext:id: 10
                            openconfig-system-ext:key-string: "cisco"
                            openconfig-system-ext:cryptographic-algorithm-tcp: "hmac-sha-1"
                            openconfig-system-ext:send-id: 99
                            openconfig-system-ext:recv-id: 100
                            openconfig-system-ext:accept-lifetime:
                              openconfig-system-ext:start-time: "00:00:00"
                              openconfig-system-ext:start-month: "Jan"
                              openconfig-system-ext:start-date: 1
                              openconfig-system-ext:start-year: 2023
                              openconfig-system-ext:duration: 364
                            openconfig-system-ext:send-lifetime:
                              openconfig-system-ext:start-time: "00:00:01"
                              openconfig-system-ext:start-month: "Feb"
                              openconfig-system-ext:start-date: 2
                              openconfig-system-ext:start-year: 2024
                              openconfig-system-ext:duration: 365
                        - openconfig-system-ext:id: 20
                          openconfig-system-ext:config:
                            openconfig-system-ext:id: 20
                            openconfig-system-ext:key-string: "cisco"
                            openconfig-system-ext:cryptographic-algorithm-tcp: "hmac-sha-256"
                            openconfig-system-ext:send-id: 150
                            openconfig-system-ext:recv-id: 151
                            openconfig-system-ext:accept-lifetime:
                              openconfig-system-ext:start-time: "01:00:00"
                              openconfig-system-ext:start-month: "Mar"
                              openconfig-system-ext:start-date: 2
                              openconfig-system-ext:start-year: 2023
                              openconfig-system-ext:stop-time: "02:00:00"
                              openconfig-system-ext:stop-month: "Jan"
                              openconfig-system-ext:stop-date: 3
                              openconfig-system-ext:stop-year: 2024
                            openconfig-system-ext:send-lifetime:
                              openconfig-system-ext:start-time: "03:00:01"
                              openconfig-system-ext:start-month: "Apr"
                              openconfig-system-ext:start-date: 4
                              openconfig-system-ext:start-year: 2025
                              openconfig-system-ext:stop-time: "04:00:00"
                              openconfig-system-ext:stop-month: "Aug"
                              openconfig-system-ext:stop-date: 5
                              openconfig-system-ext:stop-year: 2026
                        - openconfig-system-ext:id: 30
                          openconfig-system-ext:config:
                            openconfig-system-ext:id: 30
                            openconfig-system-ext:key-string: "cisco"
                            openconfig-system-ext:cryptographic-algorithm-tcp: "aes-128-cmac"
                            openconfig-system-ext:send-id: 200
                            openconfig-system-ext:recv-id: 201
                            openconfig-system-ext:accept-lifetime:
                              openconfig-system-ext:local:
                                openconfig-system-ext:start-time: "03:30:00"
                                openconfig-system-ext:start-month: "Mar"
                                openconfig-system-ext:start-date: 20
                                openconfig-system-ext:start-year: 2024
                                openconfig-system-ext:stop-time: "02:00:00"
                                openconfig-system-ext:stop-month: "Jan"
                                openconfig-system-ext:stop-date: 21
                                openconfig-system-ext:stop-year: 2025
                            openconfig-system-ext:send-lifetime:
                              openconfig-system-ext:local:
                                openconfig-system-ext:start-time: "04:30:01"
                                openconfig-system-ext:start-month: "Apr"
                                openconfig-system-ext:start-date: 15
                                openconfig-system-ext:start-year: 2027
                                openconfig-system-ext:infinite: false
                                openconfig-system-ext:stop-time: "04:00:00"
                                openconfig-system-ext:stop-month: "Aug"
                                openconfig-system-ext:stop-date: 16
                                openconfig-system-ext:stop-year: 2028
                        - openconfig-system-ext:id: 40
                          openconfig-system-ext:config:
                            openconfig-system-ext:id: 40
                            openconfig-system-ext:key-string: "cisco"
                            openconfig-system-ext:cryptographic-algorithm-tcp: "aes-128-cmac"
                            openconfig-system-ext:send-id: 225
                            openconfig-system-ext:recv-id: 226
                            openconfig-system-ext:accept-lifetime:
                              openconfig-system-ext:local:
                                openconfig-system-ext:start-time: "23:30:00"
                                openconfig-system-ext:start-month: "Dec"
                                openconfig-system-ext:start-date: 1
                                openconfig-system-ext:start-year: 2024
                                openconfig-system-ext:infinite: true
                            openconfig-system-ext:send-lifetime:
                              openconfig-system-ext:local:
                                openconfig-system-ext:start-time: "23:30:01"
                                openconfig-system-ext:start-month: "Dec"
                                openconfig-system-ext:start-date: 31
                                openconfig-system-ext:start-year: 2028
                                openconfig-system-ext:infinite: true
        api_method: PUT
        api_ignore_errors: false
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - "'+key chain OSPF_KEYCHAIN1:' in changes"
          - "'+ key 10:' in changes"
          - "'+   cryptographic-algorithm hmac-sha-1:' in changes"
          - "'+   accept-lifetime 00:00:00 Jan 1 2023 duration 364:' in changes"
          - "'+   send-lifetime 00:00:01 Feb 2 2024 duration 365:' in changes"
          - "'+ key 20:' in changes"
          - "'+   cryptographic-algorithm hmac-sha-512:' in changes"
          - "'+   accept-lifetime 01:00:00 Mar 2 2023 02:00:00 Jan 3 2024:' in changes"
          - "'+   send-lifetime 03:00:01 Apr 4 2025 04:00:00 Aug 5 2026:' in changes"
          - "'+ key 30:' in changes"
          - "'+   cryptographic-algorithm hmac-sha-512:' in changes"
          - "'+   accept-lifetime local 03:30:00 Mar 20 2024 02:00:00 Jan 21 2025:' in changes"
          - "'+   send-lifetime local 04:30:01 Apr 15 2027 04:00:00 Aug 16 2028:' in changes"
          - "'+ key 40:' in changes"
          - "'+   cryptographic-algorithm hmac-sha-512:' in changes"
          - "'+   accept-lifetime local 23:30:00 Dec 1 2024 infinite:' in changes"
          - "'+   send-lifetime local 23:30:01 Dec 31 2028 infinite:' in changes"
          - "'+key chain BGP-TCP_KEYCHAIN1 tcp:' in changes"
          - "'+ key 10:' in changes"
          - "'+   cryptographic-algorithm hmac-sha-1:' in changes"
          - "'+   accept-lifetime 00:00:00 Jan 1 2023 duration 364:' in changes"
          - "'+   send-lifetime 00:00:01 Feb 2 2024 duration 365:' in changes"
          - "'+  send-id 99:' in changes"
          - "'+  recv-id 100:' in changes"
          - "'+ key 20:' in changes"
          - "'+   cryptographic-algorithm hmac-sha-256:' in changes"
          - "'+   accept-lifetime 01:00:00 Mar 2 2023 02:00:00 Jan 3 2024:' in changes"
          - "'+   send-lifetime 03:00:01 Apr 4 2025 04:00:00 Aug 5 2026:' in changes"
          - "'+  send-id 150:' in changes"
          - "'+  recv-id 151:' in changes"
          - "'+ key 30:' in changes"
          - "'+   cryptographic-algorithm aes-128-cmac:' in changes"
          - "'+   accept-lifetime local 03:30:00 Mar 20 2024 02:00:00 Jan 21 2025:' in changes"
          - "'+   send-lifetime local 04:30:01 Apr 15 2027 04:00:00 Aug 16 2028:' in changes"
          - "'+  send-id 200:' in changes"
          - "'+  recv-id 201:' in changes"
          - "'+ key 40:' in changes"
          - "'+   cryptographic-algorithm aes-128-cmac:' in changes"
          - "'+   accept-lifetime local 23:30:00 Dec 1 2024 infinite:' in changes"
          - "'+   send-lifetime local 23:30:01 Dec 31 2028 infinite:' in changes"
          - "'+  send-id 225:' in changes"
          - "'+  recv-id 226:' in changes"

- hosts: nso
  connection: local
  gather_facts: no
  roles:
    - nso-rollback-load
  run_once: true
  vars:
    rollback_file: "{{ lookup('env', 'PWD') }}/rollback.yaml"