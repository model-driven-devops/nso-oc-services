---
- name: test network instance ospfv2 global
  hosts: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
  gather_facts: no
  connection: network_cli
  vars:
    device: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
    ansible_network_os: 'cisco.ios.ios'
  tasks:
    - name: test process
      tags:
        - process
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+router ospf 1:' in changes"

    - name: test router_id
      tags:
        - router_id
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:router-id: '1.1.1.1'
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ router-id 1.1.1.1:' in changes"

    - name: test log_adjacency_changes
      tags:
        - log_adjacency_changes
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:log-adjacency-changes: True
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: true
        assertions:
          - "'+this is a default and will not show up here:' in changes"

    - name: test prefix_suppression
      tags:
        - prefix_suppression
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:hide-transit-only-networks: True
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ prefix-suppression:' in changes"

    - name: test summary_route_cost_mode_2328
      tags:
        - summary_route_cost_mode_2328
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-network-instance:summary-route-cost-mode: 'RFC2328_COMPATIBLE'  # XE default is RFC1583_COMPATIBLE
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ no compatible rfc1583:' in changes"

    - name: test graceful_restart_enabled
      tags:
        - graceful_restart_enabled
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:global:
                            openconfig-network-instance:graceful-restart:
                              openconfig-network-instance:config:
                                openconfig-network-instance:enabled: True
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ nsf ietf:' in changes"

    - name: test inter_area_propagation_policy
      tags:
        - inter_area_propagation_policy
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'Loopback10'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'Loopback10'
                    openconfig-interfaces:type: 'softwareLoopback'
                    openconfig-interfaces:description: 'TEST123'
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.255.10.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.255.10.1'
                                  openconfig-if-ip:prefix-length: 32
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: '10'
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-routing-policy:routing-policy:
              openconfig-routing-policy:defined-sets:
                openconfig-routing-policy:prefix-sets:
                  openconfig-routing-policy:prefix-set:
                    - openconfig-routing-policy:name: 'prefix_test'
                      openconfig-routing-policy:config:
                        openconfig-routing-policy:name: 'prefix_test'
                        openconfig-routing-policy:mode: IPV4
                      openconfig-routing-policy:prefixes:
                        openconfig-routing-policy:prefix:
                          - openconfig-routing-policy:ip-prefix: '10.0.0.0/24'
                            openconfig-routing-policy:masklength-range: 'exact'
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:ip-prefix: '10.0.0.0/24'
                              openconfig-routing-policy:masklength-range: 'exact'
                              openconfig-routing-policy-ext:seq: 10
                          - openconfig-routing-policy:ip-prefix: '10.10.10.0/23'
                            openconfig-routing-policy:masklength-range: '24..30'
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:ip-prefix: '10.10.10.0/23'
                              openconfig-routing-policy:masklength-range: '24..30'
                              openconfig-routing-policy-ext:seq: 20
              openconfig-routing-policy:policy-definitions:
                openconfig-routing-policy:policy-definition:
                  - openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:config:
                      openconfig-routing-policy:name: 'test'
                    openconfig-routing-policy:statements:
                      openconfig-routing-policy:statement:
                        - openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:conditions:
                            openconfig-routing-policy:match-prefix-set:
                              openconfig-routing-policy:config:
                                openconfig-routing-policy:prefix-set: 'prefix_test'
                                openconfig-routing-policy:match-set-options: 'ANY'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'  # or REJECT_ROUTE
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 3
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 3
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'Loopback10'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'Loopback10'
                            - openconfig-network-instance:identifier: 0
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 0
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:global:
                            openconfig-network-instance:inter-area-propagation-policies:
                              openconfig-network-instance:inter-area-propagation-policy:
                                - openconfig-network-instance:src-area: 0
                                  openconfig-network-instance:dst-area: 3
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:dst-area: 3
                                    openconfig-network-instance:src-area: 0
                                    openconfig-network-instance:import-policy:
                                      - 'test'
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ area 3 filter-list prefix test in:' in changes"

    - name: test mpls_ldp_igp_sync
      tags:
        - mpls_ldp_igp_sync
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:global:
                            openconfig-network-instance:mpls:
                              openconfig-network-instance:igp-ldp-sync:
                                openconfig-network-instance:config:
                                  openconfig-network-instance:enabled: True
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ mpls ldp sync:' in changes"

    - name: test timers_lsa
      tags:
        - timers_lsa
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:global:
                            openconfig-network-instance:timers:
                              openconfig-network-instance:lsa-generation:
                                openconfig-network-instance:config:
                                  openconfig-network-instance:initial-delay: 1000
                                  openconfig-network-instance:maximum-delay: 10000
                                  openconfig-ospfv2-ext:hold-time: 5000
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ timers throttle lsa 1000 5000 10000:' in changes"

    - name: test timers_spf
      tags:
        - timers_spf
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:global:
                            openconfig-network-instance:timers:
                              openconfig-network-instance:spf:
                                openconfig-network-instance:config:
                                  openconfig-network-instance:initial-delay: 10000
                                  openconfig-network-instance:maximum-delay: 20000
                                  openconfig-ospfv2-ext:hold-time: 20000
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ timers throttle spf 10000 20000 20000:' in changes"

    - name: test process_vrf
      tags:
        - process_vrf
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                - openconfig-network-instance:name: 'abc'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'abc'
                    openconfig-network-instance:type: 'L3VRF'
                    openconfig-network-instance:enabled: true
                    openconfig-network-instance:enabled-address-families:
                      - 'IPV4'
                    openconfig-network-instance:route-distinguisher: '1:1'
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+router ospf 1 vrf abc:' in changes"
    - name: test process_vrf_capability_vrf_lite
      tags:
        - process_vrf_capability_vrf_lite
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                - openconfig-network-instance:name: 'abc'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'abc'
                    openconfig-network-instance:type: 'L3VRF'
                    openconfig-network-instance:enabled: true
                    openconfig-network-instance:enabled-address-families:
                      - 'IPV4'
                    openconfig-network-instance:route-distinguisher: '1:1'
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-ospfv2-ext:capability-vrf-lite: True
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ capability vrf-lite:' in changes"
    - name: test default_information_originate
      tags:
        - default_information_originate
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-ospfv2-ext:default-information-originate:
                                openconfig-ospfv2-ext:config:
                                  openconfig-ospfv2-ext:enabled: True
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ default-information originate:' in changes"

    - name: test default_information_originate_options
      tags:
        - default_information_originate
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-routing-policy:routing-policy:
              openconfig-routing-policy:policy-definitions:
                openconfig-routing-policy:policy-definition:
                  - openconfig-routing-policy:name: 'TEST'
                    openconfig-routing-policy:config:
                      openconfig-routing-policy:name: 'TEST'
                    openconfig-routing-policy:statements:
                      openconfig-routing-policy:statement:
                        - openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:config:
                            openconfig-routing-policy:name: '10'
                          openconfig-routing-policy:actions:
                            openconfig-routing-policy:config:
                              openconfig-routing-policy:policy-result: 'ACCEPT_ROUTE'
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-ospfv2-ext:default-information-originate:
                                openconfig-ospfv2-ext:config:
                                  openconfig-ospfv2-ext:enabled: True
                                  openconfig-ospfv2-ext:always: True
                                  openconfig-ospfv2-ext:metric: '5'
                                  openconfig-ospfv2-ext:metric-type: '1'
                                  openconfig-ospfv2-ext:route-map: 'TEST' 

        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ default-information originate always metric 5 metric-type 1 route-map TEST:' in changes"

    - name: test auto_cost_reference_bandwidth
      tags:
        - auto_cost_reference_bandwidth
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: true
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:global:
                            openconfig-network-instance:config:
                              openconfig-ospfv2-ext:auto-cost-ref-bandwidth: '100000'
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+router ospf 1:' in changes"
          - "'+ auto-cost reference-bandwidth 100000:' in changes"

    - name: test interface_ospf_authentication_md5
      tags:
        - interface_ospf_authentication_md5
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                              - openconfig-network-instance:identifier: 3
                                openconfig-network-instance:config:
                                  openconfig-network-instance:identifier: 3
                                openconfig-network-instance:interfaces:
                                  openconfig-network-instance:interface:
                                    - openconfig-network-instance:id: 'GigabitEthernet6'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:id: 'GigabitEthernet6'
                                      openconfig-ospfv2-ext:authentication:
                                        openconfig-ospfv2-ext:config:
                                          openconfig-ospfv2-ext:authentication-type: MD5
                                        openconfig-ospfv2-ext:md5-authentication-keys:
                                          openconfig-ospfv2-ext:md5-authentication-key:
                                            - openconfig-ospfv2-ext:key-id: 2
                                              openconfig-ospfv2-ext:config:
                                                openconfig-ospfv2-ext:key-id: 2
                                                openconfig-ospfv2-ext:key: 'pass1'
                                            - openconfig-ospfv2-ext:key-id: 3 
                                              openconfig-ospfv2-ext:config:
                                                openconfig-ospfv2-ext:key-id: 3
                                                openconfig-ospfv2-ext:key: 'pass2'
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "' interface GigabitEthernet6:' in changes"
          - "'+ ip ospf authentication message-digest:' in changes"
          - "'+ ip ospf message-digest-key 2 md5 pass1:' in changes"
          - "'+ ip ospf message-digest-key 3 md5 pass2:' in changes"

    - name: test interface_ospf_authentication_simple
      tags:
        - interface_ospf_authentication_simple
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 3
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 3
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-ospfv2-ext:authentication:
                                    openconfig-ospfv2-ext:config:
                                      openconfig-ospfv2-ext:authentication-type: SIMPLE
                                      openconfig-ospfv2-ext:simple-password: abc123
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "' interface GigabitEthernet6:' in changes"
          - "'+ ip ospf authentication:' in changes"
          - "'+ ip ospf authentication-key abc123:' in changes"

    - name: test interface_ospf_authentication_keychain
      tags:
        - interface_ospf_authentication_keychain
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-system:system:
              openconfig-system-ext:services:
                openconfig-system-ext:key-chains:
                  openconfig-system-ext:key-chain:
                    - openconfig-system-ext:name: OSPF_KEYCHAIN100
                      openconfig-system-ext:type: NOT_APPLICABLE
                      openconfig-system-ext:keys:
                        - openconfig-system-ext:id: 10
                          openconfig-system-ext:config:
                            openconfig-system-ext:id: 10
                            openconfig-system-ext:key-string: "cisco"
                            openconfig-system-ext:cryptographic-algorithm: "hmac-sha-1"
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 3
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 3
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-ospfv2-ext:authentication:
                                    openconfig-ospfv2-ext:config:
                                      openconfig-ospfv2-ext:authentication-type: KEY-CHAIN
                                      openconfig-ospfv2-ext:key-chain: OSPF_KEYCHAIN100
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "' interface GigabitEthernet6:' in changes"
          - "'+ ip ospf authentication key-chain OSPF_KEYCHAIN100:' in changes"

    - name: test interface_ospf_authentication_null
      tags:
        - interface_ospf_authentication_null
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 3
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 3
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-ospfv2-ext:authentication:
                                    openconfig-ospfv2-ext:config:
                                      openconfig-ospfv2-ext:authentication-type: 'NULL'
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "' interface GigabitEthernet6:' in changes"
          - "'+ ip ospf authentication null:' in changes"

    - name: test interface_ospf_authentication_unconfigured
      tags:
        - interface_ospf_authentication_unconfigured
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 3
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 3
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-ospfv2-ext:authentication:
                                    openconfig-ospfv2-ext:config:
                                      openconfig-ospfv2-ext:authentication-type: UNCONFIGURED
        api_method: PUT
        api_ignore_errors: false
        rollback: true
        assertion_ignore_errors: false
        assertions:  false  # default nothing to see
