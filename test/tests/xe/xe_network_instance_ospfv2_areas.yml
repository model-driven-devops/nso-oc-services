---
- name: test network instance ospfv2 areas
  hosts: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
  gather_facts: no
  connection: network_cli
  vars:
    device: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
    ansible_network_os: 'cisco.ios.ios'
  tasks:
    - name: test area
      tags:
        - area
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'Loopback10'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'Loopback10'
                    openconfig-interfaces:type: 'softwareLoopback'
                    openconfig-interfaces:description: 'TEST123'
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.255.10.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.255.10.1'
                                  openconfig-if-ip:prefix-length: 32
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 1
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 1
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'Loopback10'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'Loopback10'
                            - openconfig-network-instance:identifier: 0
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 0
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'Loopback10'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'Loopback10'
                          openconfig-network-instance:interface: 'Loopback10'
                          openconfig-network-instance:subinterface: '0'
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: '0'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+router ospf 1:' in changes"
          - "'+ network 10.255.10.1 0.0.0.0 area 1:' in changes"
          - "'+ network 10.6.0.1 0.0.0.0 area 0:' in changes"

    - name: test network_type
      tags:
        - network_type
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 0
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 0
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                                    openconfig-network-instance:network-type: 'NON_BROADCAST_NETWORK'
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ ip ospf network non-broadcast:' in changes"

    - name: test interface_cost
      tags:
        - interface_cost
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 0
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 0
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                                    openconfig-network-instance:metric: 10
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ ip ospf cost 10:' in changes"

    - name: test passive_interface
      tags:
        - passive_interface
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 0
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 0
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                                    openconfig-network-instance:passive: True
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ passive-interface GigabitEthernet6:' in changes"

    - name: test priority
      tags:
        - priority
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 0
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 0
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                                    openconfig-network-instance:priority: 10
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ ip ospf priority 10:' in changes"

    - name: test ospf_bfd
      tags:
        - ospf_bfd
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 0
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 0
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:enable-bfd:
                                    openconfig-network-instance:config:
                                      openconfig-network-instance:enabled: True
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ ip ospf bfd:' in changes"

    - name: test neighbor
      tags:
        - neighbor
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 0
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 0
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:neighbors:
                                    openconfig-network-instance:neighbor:
                                    - openconfig-network-instance:router-id: '10.10.10.10'
                                      openconfig-network-instance:config:
                                        openconfig-network-instance:metric: 100
                                        openconfig-network-instance:router-id: '10.10.10.10'
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+router ospf 1:' in changes"
          - "'+ neighbor 10.10.10.10 cost 100:' in changes"

    - name: test interface_timers
      tags:
        - interface_timers
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 0
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 0
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:timers:
                                    openconfig-network-instance:config:
                                      openconfig-network-instance:dead-interval: 60
                                      openconfig-network-instance:hello-interval: 15
                                      openconfig-network-instance:retransmission-interval: 10
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ ip ospf dead-interval 60:' in changes"
          - "'+ ip ospf hello-interval 15:' in changes"
          - "'+ ip ospf retransmit-interval 10:' in changes"

    - name: test mpls_traffic_eng_area
      tags:
        - mpls_traffic_eng_area
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 0
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 0
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                              openconfig-network-instance:mpls:
                                openconfig-network-instance:config:
                                  openconfig-network-instance:traffic-engineering-enabled: True
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ mpls traffic-eng area 0:' in changes"

    - name: test virtual_link
      tags:
        - virtual_link
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 200
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 200
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                              openconfig-network-instance:virtual-links:
                                openconfig-network-instance:virtual-link:
                                - openconfig-network-instance:remote-router-id: '10.200.200.200'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:remote-router-id: '10.200.200.200'
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ area 200 virtual-link 10.200.200.200:' in changes"

    - name: test stub_area
      tags:
        - stub_area
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 200
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 200
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                              openconfig-ospfv2-ext:stub-options:
                                openconfig-ospfv2-ext:stub:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: true
                                    openconfig-ospfv2-ext:default-information-originate: true
                                openconfig-ospfv2-ext:totally-stubby:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: false
                                    openconfig-ospfv2-ext:default-information-originate: false
                                openconfig-ospfv2-ext:nssa:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: false
                                    openconfig-ospfv2-ext:default-information-originate: false
                                    openconfig-ospfv2-ext:no-summary: false
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ area 200 stub:' in changes"

    - name: test totally_stubby_area
      tags:
        - totally_stubby_area
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 200
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 200
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                              openconfig-ospfv2-ext:stub-options:
                                openconfig-ospfv2-ext:stub:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: false
                                    openconfig-ospfv2-ext:default-information-originate: false
                                openconfig-ospfv2-ext:totally-stubby:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: true
                                    openconfig-ospfv2-ext:default-information-originate: true
                                openconfig-ospfv2-ext:nssa:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: false
                                    openconfig-ospfv2-ext:default-information-originate: false
                                    openconfig-ospfv2-ext:no-summary: false
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ area 200 stub no-summary:' in changes"

    - name: test nsa
      tags:
        - nsa
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 200
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 200
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                              openconfig-ospfv2-ext:stub-options:
                                openconfig-ospfv2-ext:stub:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: false
                                    openconfig-ospfv2-ext:default-information-originate: false
                                openconfig-ospfv2-ext:totally-stubby:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: false
                                    openconfig-ospfv2-ext:default-information-originate: false
                                openconfig-ospfv2-ext:nssa:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: true
                                    openconfig-ospfv2-ext:default-information-originate: false
                                    openconfig-ospfv2-ext:no-summary: false
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ area 200 nssa:' in changes"

    - name: test nssa_default_originate
      tags:
        - nssa_default_originate
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 200
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 200
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                              openconfig-ospfv2-ext:stub-options:
                                openconfig-ospfv2-ext:stub:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: false
                                    openconfig-ospfv2-ext:default-information-originate: false
                                openconfig-ospfv2-ext:totally-stubby:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: false
                                    openconfig-ospfv2-ext:default-information-originate: false
                                openconfig-ospfv2-ext:nssa:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: true
                                    openconfig-ospfv2-ext:default-information-originate: true
                                    openconfig-ospfv2-ext:no-summary: false
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ area 200 nssa default-information-originate:' in changes"

    - name: test nssa_default_originate_no_summary
      tags:
        - nssa_default_originate_no_summary
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 200
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 200
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                              openconfig-ospfv2-ext:stub-options:
                                openconfig-ospfv2-ext:stub:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: false
                                    openconfig-ospfv2-ext:default-information-originate: false
                                openconfig-ospfv2-ext:totally-stubby:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: false
                                    openconfig-ospfv2-ext:default-information-originate: false
                                openconfig-ospfv2-ext:nssa:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: true
                                    openconfig-ospfv2-ext:default-information-originate: false
                                    openconfig-ospfv2-ext:no-summary: true
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ area 200 nssa no-summary:' in changes"

    - name: test error_nssa_and_stub
      tags:
        - error_nssa_and_stub
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              openconfig-interfaces:interface:
                - openconfig-interfaces:name: 'GigabitEthernet6'
                  openconfig-interfaces:config:
                    openconfig-interfaces:enabled: true
                    openconfig-interfaces:name: 'GigabitEthernet6'
                    openconfig-interfaces:type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    openconfig-if-ethernet:config:
                      openconfig-if-ethernet:auto-negotiate: true
                      openconfig-if-ethernet:enable-flow-control: false
                  openconfig-interfaces:hold-time:
                    openconfig-interfaces:config:
                      openconfig-interfaces:down: 10
                  openconfig-interfaces:subinterfaces:
                    openconfig-interfaces:subinterface:
                      - openconfig-interfaces:index: 0
                        openconfig-interfaces:config:
                          openconfig-interfaces:index: 0
                        openconfig-if-ip:ipv4:
                          openconfig-if-ip:addresses:
                            openconfig-if-ip:address:
                              - openconfig-if-ip:ip: '10.6.0.1'
                                openconfig-if-ip:config:
                                  openconfig-if-ip:ip: '10.6.0.1'
                                  openconfig-if-ip:prefix-length: 24
                          openconfig-if-ip:config:
                            openconfig-if-ip:dhcp-client: false
            openconfig-network-instance:network-instances:
              openconfig-network-instance:network-instance:
                - openconfig-network-instance:name: 'default'
                  openconfig-network-instance:config:
                    openconfig-network-instance:name: 'default'
                    openconfig-network-instance:type: 'DEFAULT_INSTANCE'
                    openconfig-network-instance:enabled: true
                  openconfig-network-instance:protocols:
                    openconfig-network-instance:protocol:
                      - openconfig-network-instance:identifier: 'OSPF'
                        openconfig-network-instance:name: '1'
                        openconfig-network-instance:config:
                          openconfig-network-instance:enabled: True
                          openconfig-network-instance:identifier: 'OSPF'
                          openconfig-network-instance:name: '1'
                        openconfig-network-instance:ospfv2:
                          openconfig-network-instance:areas:
                            openconfig-network-instance:area:
                            - openconfig-network-instance:identifier: 200
                              openconfig-network-instance:config:
                                openconfig-network-instance:identifier: 200
                              openconfig-network-instance:interfaces:
                                openconfig-network-instance:interface:
                                - openconfig-network-instance:id: 'GigabitEthernet6'
                                  openconfig-network-instance:config:
                                    openconfig-network-instance:id: 'GigabitEthernet6'
                              openconfig-ospfv2-ext:stub-options:
                                openconfig-ospfv2-ext:stub:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: true
                                    openconfig-ospfv2-ext:default-information-originate: true
                                openconfig-ospfv2-ext:totally-stubby:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: false
                                    openconfig-ospfv2-ext:default-information-originate: false
                                openconfig-ospfv2-ext:nssa:
                                  openconfig-ospfv2-ext:config:
                                    openconfig-ospfv2-ext:enabled: true
                                    openconfig-ospfv2-ext:default-information-originate: false
                                    openconfig-ospfv2-ext:no-summary: true
                  openconfig-network-instance:interfaces:
                    openconfig-network-instance:interface:
                      - openconfig-network-instance:id: 'GigabitEthernet6'
                        openconfig-network-instance:config:
                          openconfig-network-instance:id: 'GigabitEthernet6'
                          openconfig-network-instance:interface: 'GigabitEthernet6'
                          openconfig-network-instance:subinterface: 0
        api_method: PUT
        api_ignore_errors: true
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - error_results.json['ietf-restconf:errors']['error'][0]['error-message'] == "Python cb_create error. OSPF stub areas can only be type stub, totally-stubby, or nssa: not more than one type."
