---
- name: test network instance ospfv2 areas
  hosts: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
  gather_facts: no
  connection: network_cli
  vars:
    device: "{{ lookup('env', 'TEST_DEVICE_XEROUTER') | default('xe1', True) }}"
    ansible_network_os: 'cisco.ios.ios'
  tasks:
    - name: test area
      tags:
        - area
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'Loopback10'
                    type: 'softwareLoopback'
                    description: 'TEST123'
                  name: 'Loopback10'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.16.1.2'
                                  prefix-length: 32
                                ip: '172.16.1.2'
                          config:
                            dhcp-client: false
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 1
                              identifier: 1
                              interfaces:
                                interface:
                                - config:
                                    id: 'Loopback10'
                                  id: 'Loopback10'
                            - config:
                                identifier: 0
                              identifier: 0
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                  id: 'GigabitEthernet6'
                  interfaces:
                    interface:
                      - id: 'Loopback10'
                        config:
                          id: 'Loopback10'
                          interface: 'Loopback10'
                          subinterface: '0'
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: '0'
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+router ospf 1:' in changes"
          - "'+ network 172.16.1.2 0.0.0.0 area 1:' in changes"
          - "'+ network 172.17.0.1 0.0.0.0 area 0:' in changes"

    - name: test network_type
      tags:
        - network_type
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 0
                              identifier: 0
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                    network-type: 'NON_BROADCAST_NETWORK'
                                  id: 'GigabitEthernet6'
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ ip ospf network non-broadcast:' in changes"

    - name: test interface_cost
      tags:
        - interface_cost
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 0
                              identifier: 0
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                    metric: 10
                                  id: 'GigabitEthernet6'
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ ip ospf cost 10:' in changes"

    - name: test passive_interface
      tags:
        - passive_interface
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 0
                              identifier: 0
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                    passive: True
                                  id: 'GigabitEthernet6'
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ passive-interface GigabitEthernet6:' in changes"

    - name: test priority
      tags:
        - priority
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 0
                              identifier: 0
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                    priority: 10
                                  id: 'GigabitEthernet6'
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ ip ospf priority 10:' in changes"

    - name: test ospf_bfd
      tags:
        - ospf_bfd
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 0
                              identifier: 0
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                  enable-bfd:
                                    config:
                                      enabled: True
                                  id: 'GigabitEthernet6'
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ ip ospf bfd:' in changes"

    - name: test neighbor
      tags:
        - neighbor
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 0
                              identifier: 0
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                  neighbors:
                                    neighbor:
                                    - config:
                                        metric: 100
                                        router-id: '10.10.10.10'
                                      router-id: '10.10.10.10'
                                  id: 'GigabitEthernet6'
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+router ospf 1:' in changes"
          - "'+ neighbor 10.10.10.10 cost 100:' in changes"

    - name: test interface_timers
      tags:
        - interface_timers
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 0
                              identifier: 0
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                  timers:
                                    config:
                                      dead-interval: 60
                                      hello-interval: 15
                                      retransmission-interval: 10
                                  id: 'GigabitEthernet6'
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ ip ospf dead-interval 60:' in changes"
          - "'+ ip ospf hello-interval 15:' in changes"
          - "'+ ip ospf retransmit-interval 10:' in changes"

    - name: test mpls_traffic_eng_area
      tags:
        - mpls_traffic_eng_area
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 0
                              identifier: 0
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                  id: 'GigabitEthernet6'
                              mpls:
                                config:
                                  traffic-engineering-enabled: True
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ mpls traffic-eng area 0:' in changes"

    - name: test virtual_link
      tags:
        - virtual_link
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 200
                              identifier: 200
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                  id: 'GigabitEthernet6'
                              virtual-links:
                                virtual-link:
                                - config:
                                    remote-router-id: '10.200.200.200'
                                  remote-router-id: '10.200.200.200'
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ area 200 virtual-link 10.200.200.200:' in changes"

    - name: test stub_area
      tags:
        - stub_area
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 200
                              identifier: 200
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                  id: 'GigabitEthernet6'
                              openconfig-ospfv2-ext:stub-options:
                                stub:
                                  config:
                                    enabled: true
                                    default-information-originate: true
                                totally-stubby:
                                  config:
                                    enabled: false
                                    default-information-originate: false
                                nssa:
                                  config:
                                    enabled: false
                                    default-information-originate: false
                                    no-summary: false
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ area 200 stub:' in changes"

    - name: test totally_stubby_area
      tags:
        - totally_stubby_area
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 200
                              identifier: 200
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                  id: 'GigabitEthernet6'
                              openconfig-ospfv2-ext:stub-options:
                                stub:
                                  config:
                                    enabled: false
                                    default-information-originate: false
                                totally-stubby:
                                  config:
                                    enabled: true
                                    default-information-originate: true
                                nssa:
                                  config:
                                    enabled: false
                                    default-information-originate: false
                                    no-summary: false
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ area 200 stub no-summary:' in changes"

    - name: test nsa
      tags:
        - nsa
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 200
                              identifier: 200
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                  id: 'GigabitEthernet6'
                              openconfig-ospfv2-ext:stub-options:
                                stub:
                                  config:
                                    enabled: false
                                    default-information-originate: false
                                totally-stubby:
                                  config:
                                    enabled: false
                                    default-information-originate: false
                                nssa:
                                  config:
                                    enabled: true
                                    default-information-originate: false
                                    no-summary: false
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ area 200 nssa:' in changes"

    - name: test nssa_default_originate
      tags:
        - nssa_default_originate
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 200
                              identifier: 200
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                  id: 'GigabitEthernet6'
                              openconfig-ospfv2-ext:stub-options:
                                stub:
                                  config:
                                    enabled: false
                                    default-information-originate: false
                                totally-stubby:
                                  config:
                                    enabled: false
                                    default-information-originate: false
                                nssa:
                                  config:
                                    enabled: true
                                    default-information-originate: true
                                    no-summary: false
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ area 200 nssa default-information-originate:' in changes"

    - name: test nssa_default_originate_no_summary
      tags:
        - nssa_default_originate_no_summary
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 200
                              identifier: 200
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                  id: 'GigabitEthernet6'
                              openconfig-ospfv2-ext:stub-options:
                                stub:
                                  config:
                                    enabled: false
                                    default-information-originate: false
                                totally-stubby:
                                  config:
                                    enabled: false
                                    default-information-originate: false
                                nssa:
                                  config:
                                    enabled: true
                                    default-information-originate: false
                                    no-summary: true
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        rollback: true
        assertion_ignore_errors: false
        assertions:
          - "'+ area 200 nssa no-summary:' in changes"

    - name: test error_nssa_and_stub
      tags:
        - error_nssa_and_stub
      import_role:
        name: nso-openconfig-test
      vars:
        content: |
          mdd:openconfig:
            openconfig-interfaces:interfaces:
              interface:
                - config:
                    enabled: true
                    name: 'GigabitEthernet6'
                    type: 'ethernetCsmacd'
                  openconfig-if-ethernet:ethernet:
                    config:
                      auto-negotiate: true
                      enable-flow-control: false
                  hold-time:
                    config:
                      down: 10
                  name: 'GigabitEthernet6'
                  subinterfaces:
                    subinterface:
                      - config:
                          index: 0
                        index: 0
                        openconfig-if-ip:ipv4:
                          addresses:
                            address:
                              - config:
                                  ip: '172.17.0.1'
                                  prefix-length: 24
                                ip: '172.17.0.1'
                          config:
                            dhcp-client: false
            openconfig-network-instance:network-instances:
              network-instance:
                - name: 'default'
                  config:
                    name: 'default'
                    type: 'DEFAULT_INSTANCE'
                    enabled: true
                  protocols:
                    protocol:
                      - name: '1'
                        identifier: 'OSPF'
                        config:
                          enabled: True
                          identifier: 'OSPF'
                          name: '1'
                        ospfv2:
                          areas:
                            area:
                            - config:
                                identifier: 200
                              identifier: 200
                              interfaces:
                                interface:
                                - config:
                                    id: 'GigabitEthernet6'
                                  id: 'GigabitEthernet6'
                              openconfig-ospfv2-ext:stub-options:
                                stub:
                                  config:
                                    enabled: true
                                    default-information-originate: true
                                totally-stubby:
                                  config:
                                    enabled: false
                                    default-information-originate: false
                                nssa:
                                  config:
                                    enabled: true
                                    default-information-originate: false
                                    no-summary: true
                  interfaces:
                    interface:
                      - id: 'GigabitEthernet6'
                        config:
                          id: 'GigabitEthernet6'
                          interface: 'GigabitEthernet6'
                          subinterface: 0
        api_method: PUT
        api_ignore_errors: true
        rollback: false
        assertion_ignore_errors: false
        assertions:
          - error_results.json['ietf-restconf:errors']['error'][0]['error-message'] == "Python cb_create error. OSPF stub areas can only be type stub, totally-stubby, or nssa: not more than one type."
